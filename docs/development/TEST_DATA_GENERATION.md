# Pilot Test Data Generation Reference

Phase 7 introduces management commands to produce realistic pilot datasets covering
planning, budgeting, and user onboarding.

## Commands Overview

| Command | Purpose |
| --- | --- |
| `python manage.py load_pilot_moas` | Ensures MOH, MOLE, and MAFAR records exist in `organizations.Organization` |
| `python manage.py generate_sample_programs --organization MOH` | Creates strategic plan, annual work plan, and objectives |
| `python manage.py generate_sample_budgets --organization MOH` | Generates budget proposals, program budgets, allotments, obligations, and disbursements |
| `python manage.py generate_pilot_data` | Full orchestration (planning + budgeting + pilot users) |

## Quick Start
```bash
python manage.py load_pilot_moas
python manage.py generate_pilot_data --users 5 --programs 3 --year 2025
```

### Options
- `--moa`: Limit to a specific organization code (e.g., `--moa MOH`)
- `--users`: Number of synthetic users per organization
- `--programs`: Number of objectives per organization
- `--year`: Strategic/budget cycle year (defaults to 2025)

## Data Relationships
- Work plan objectives generated by `generate_sample_programs` feed into
  `generate_sample_budgets` to satisfy Parliament Bill No. 325 linkages
- Pilot users are created via `PilotUserService` ensuring membership records and email
  notifications
- Budget data is scoped per organization with dedicated `coordination.Organization`
  records for compatibility with existing modules

## Cleanup
To reset the staging database, restore from the latest backup:
```bash
./scripts/restore_pilot_db.sh /var/backups/bmms/pilot/bmms_pilot_latest.sql
```

Use `flush` only in isolated sandboxes; production-like staging relies on backups to
avoid orphaning migrations.
