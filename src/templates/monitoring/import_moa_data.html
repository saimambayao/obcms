{% extends "base.html" %}

{% block title %}Import MOA PPAs Data{% endblock %}

{% block breadcrumb %}
<li>
    <a href="{% url 'common:dashboard' %}" class="text-neutral-500 hover:text-neutral-700">Dashboard</a>
    <span class="text-neutral-400 mx-1">/</span>
</li>
<li>
    <a href="{% url 'monitoring:home' %}" class="text-neutral-500 hover:text-neutral-700">M&E</a>
    <span class="text-neutral-400 mx-1">/</span>
</li>
<li>
    <a href="{% url 'monitoring:moa_ppas' %}" class="text-neutral-500 hover:text-neutral-700">MOA PPAs</a>
    <span class="text-neutral-400 mx-1">/</span>
</li>
<li class="text-neutral-800 font-semibold">Import Data</li>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-6">
    <!-- Header -->
    <header class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-neutral-800">Import MOA PPAs Data</h1>
            <p class="text-neutral-600 mt-1">Upload a CSV file to bulk import MOA Programs, Projects, and Activities</p>
        </div>
        <a href="{% url 'monitoring:moa_ppas' %}" class="inline-flex items-center px-4 py-2 border border-neutral-300 rounded-lg text-sm font-medium text-neutral-700 bg-white hover:bg-neutral-50">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to MOA PPAs
        </a>
    </header>

    <!-- Import Form -->
    <div class="bg-white rounded-xl border border-neutral-200 shadow-sm">
        <div class="px-6 py-4 border-b border-neutral-200">
            <h2 class="text-lg font-semibold text-neutral-800">Upload CSV File</h2>
            <p class="text-sm text-neutral-600 mt-1">Select a CSV file with MOA PPAs data to import</p>
        </div>

        <form method="post" enctype="multipart/form-data" class="px-6 py-6">
            {% csrf_token %}

            <div class="mb-6">
                <label for="csv_file" class="block text-sm font-medium text-neutral-700 mb-2">CSV File</label>
                <div class="flex items-center justify-center w-full">
                    <label for="csv_file" class="flex flex-col items-center justify-center w-full h-32 border-2 border-neutral-300 border-dashed rounded-lg cursor-pointer bg-neutral-50 hover:bg-neutral-100">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i class="fas fa-cloud-upload-alt text-neutral-400 text-2xl mb-2"></i>
                            <p class="mb-2 text-sm text-neutral-500">
                                <span class="font-semibold">Click to upload</span> or drag and drop
                            </p>
                            <p class="text-xs text-neutral-500">CSV files only</p>
                        </div>
                        <input id="csv_file" name="csv_file" type="file" accept=".csv" class="hidden" required>
                    </label>
                </div>
            </div>

            <div class="flex items-center justify-between">
                <button type="submit" class="btn-primary inline-flex items-center px-6 py-3 rounded-lg text-white font-medium">
                    <i class="fas fa-upload mr-2"></i>
                    Import Data
                </button>
            </div>
        </form>
    </div>

    <!-- CSV Format Guide -->
    <div class="bg-blue-50 rounded-xl border border-blue-200 p-6">
        <h3 class="text-lg font-semibold text-blue-900 mb-4 flex items-center">
            <i class="fas fa-info-circle mr-2"></i>
            CSV Format Guide
        </h3>

        <p class="text-blue-800 mb-4">Your CSV file should include the following columns (header row required):</p>

        <div class="grid gap-3 md:grid-cols-2">
            {% for header in sample_csv_headers %}
            <div class="flex items-center space-x-2">
                <span class="inline-flex items-center px-2 py-1 rounded text-xs font-mono bg-blue-100 text-blue-800">{{ header }}</span>
                {% if header == "title" %}
                    <span class="text-sm text-blue-700">(Required) - Name of the PPA</span>
                {% elif header == "status" %}
                    <span class="text-sm text-blue-700">planning, ongoing, completed, on_hold, cancelled</span>
                {% elif header == "progress" %}
                    <span class="text-sm text-blue-700">Number from 0 to 100</span>
                {% else %}
                    <span class="text-sm text-blue-700">(Optional)</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <div class="mt-4 p-4 bg-blue-100 rounded-lg">
            <h4 class="font-medium text-blue-900 mb-2">Sample CSV content:</h4>
            <code class="text-xs text-blue-800 block whitespace-pre-line font-mono">title,summary,status,progress,budget_allocation,oobc_unit
"Skills Training Program","Vocational training for OBC youth",ongoing,65,500000,"Training Division"
"Infrastructure Development","Road improvement project",planning,10,2000000,"Infrastructure Unit"</code>
        </div>
    </div>
</div>

<script>
// File upload preview
document.getElementById('csv_file').addEventListener('change', function(e) {
    const fileName = e.target.files[0]?.name;
    if (fileName) {
        const label = e.target.closest('label');
        const textElement = label.querySelector('.font-semibold').parentElement;
        textElement.innerHTML = `<span class="font-semibold">${fileName}</span> selected`;
    }
});
</script>
{% endblock %}