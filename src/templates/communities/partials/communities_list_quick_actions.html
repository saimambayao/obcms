{# Communities List - Header Quick Actions #}
{# Replace or supplement the header action buttons in communities_manage.html #}

<div class="mb-8 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
    <div>
        <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
            <i class="fas fa-edit text-green-600"></i>
            <span>{{ page_title|default:'Manage Barangay OBC' }}</span>
            {% if show_archived %}
            <span class="inline-flex items-center px-3 py-1 text-xs font-semibold uppercase tracking-wide rounded-full bg-amber-100 text-amber-800">
                Archived view
            </span>
            {% endif %}
        </h1>
        <p class="mt-2 text-lg text-gray-600">
            {{ page_description|default:'View, edit, and manage barangay-level OBC communities' }}
        </p>
    </div>

    <!-- Enhanced Quick Actions Header -->
    <div class="flex flex-wrap items-center gap-3">
        <!-- Add Community -->
        <a href="{% url 'common:communities_add' %}"
           class="inline-flex items-center bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white px-4 py-2.5 rounded-xl font-semibold shadow-lg hover:shadow-blue-500/50 transition-all duration-200 group">
            <i class="fas fa-plus mr-2 group-hover:rotate-90 transition-transform duration-200"></i>
            Add Community
        </a>

        <!-- Bulk Import -->
        <button
            type="button"
            onclick="showBulkImportModal()"
            class="inline-flex items-center bg-white border-2 border-purple-500 text-purple-600 hover:bg-purple-50 px-4 py-2.5 rounded-xl font-semibold transition-all duration-200 group">
            <i class="fas fa-file-import mr-2 group-hover:scale-110 transition-transform"></i>
            Bulk Import
        </button>

        <!-- Export Data -->
        <div class="relative" x-data="{ open: false }">
            <button
                @click="open = !open"
                type="button"
                class="inline-flex items-center bg-white border-2 border-emerald-500 text-emerald-600 hover:bg-emerald-50 px-4 py-2.5 rounded-xl font-semibold transition-all duration-200 group">
                <i class="fas fa-download mr-2 group-hover:scale-110 transition-transform"></i>
                Export Data
                <i class="fas fa-chevron-down ml-2 text-sm"></i>
            </button>
            <div
                x-show="open"
                @click.away="open = false"
                x-transition
                class="absolute right-0 top-full mt-2 w-56 bg-white border border-gray-200 rounded-xl shadow-2xl z-10 overflow-hidden"
                style="display: none;"
            >
                <a href="{% url 'common:communities_manage' %}?export=csv" class="block px-4 py-3 text-sm text-gray-700 hover:bg-emerald-50 flex items-center gap-3">
                    <i class="fas fa-file-csv text-emerald-600"></i>
                    <div>
                        <p class="font-semibold">Export as CSV</p>
                        <p class="text-xs text-gray-500">Spreadsheet format</p>
                    </div>
                </a>
                <a href="{% url 'common:communities_manage' %}?export=excel" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 flex items-center gap-3">
                    <i class="fas fa-file-excel text-blue-600"></i>
                    <div>
                        <p class="font-semibold">Export as Excel</p>
                        <p class="text-xs text-gray-500">XLSX format</p>
                    </div>
                </a>
                <a href="{% url 'common:communities_manage' %}?export=pdf" class="block px-4 py-3 text-sm text-gray-700 hover:bg-rose-50 flex items-center gap-3">
                    <i class="fas fa-file-pdf text-rose-600"></i>
                    <div>
                        <p class="font-semibold">Export as PDF</p>
                        <p class="text-xs text-gray-500">Report format</p>
                    </div>
                </a>
            </div>
        </div>

        <!-- Generate Reports -->
        <div class="relative" x-data="{ open: false }">
            <button
                @click="open = !open"
                type="button"
                class="inline-flex items-center bg-white border-2 border-amber-500 text-amber-600 hover:bg-amber-50 px-4 py-2.5 rounded-xl font-semibold transition-all duration-200 group">
                <i class="fas fa-chart-bar mr-2 group-hover:scale-110 transition-transform"></i>
                Reports
                <i class="fas fa-chevron-down ml-2 text-sm"></i>
            </button>
            <div
                x-show="open"
                @click.away="open = false"
                x-transition
                class="absolute right-0 top-full mt-2 w-64 bg-white border border-gray-200 rounded-xl shadow-2xl z-10 overflow-hidden"
                style="display: none;"
            >
                <a href="{% url 'common:communities_home' %}" class="block px-4 py-3 text-sm text-gray-700 hover:bg-amber-50 flex items-center gap-3">
                    <i class="fas fa-chart-pie text-amber-600"></i>
                    <div>
                        <p class="font-semibold">Coverage Summary</p>
                        <p class="text-xs text-gray-500">Regional overview</p>
                    </div>
                </a>
                <a href="#" onclick="alert('Demographic report generation coming soon'); return false;" class="block px-4 py-3 text-sm text-gray-700 hover:bg-purple-50 flex items-center gap-3">
                    <i class="fas fa-users text-purple-600"></i>
                    <div>
                        <p class="font-semibold">Demographics Report</p>
                        <p class="text-xs text-gray-500">Population breakdown</p>
                    </div>
                </a>
                <a href="#" onclick="alert('Needs assessment report coming soon'); return false;" class="block px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 flex items-center gap-3">
                    <i class="fas fa-clipboard-list text-blue-600"></i>
                    <div>
                        <p class="font-semibold">Needs Assessment</p>
                        <p class="text-xs text-gray-500">MANA data summary</p>
                    </div>
                </a>
            </div>
        </div>

        <!-- Map View -->
        <a href="{% url 'common:communities_view' %}?view=map"
           class="inline-flex items-center bg-white border-2 border-indigo-500 text-indigo-600 hover:bg-indigo-50 px-4 py-2.5 rounded-xl font-semibold transition-all duration-200 group">
            <i class="fas fa-map-marked-alt mr-2 group-hover:scale-110 transition-transform"></i>
            Map View
        </a>

        <!-- Archived Toggle -->
        {% if show_archived %}
        <a href="{% url 'common:communities_manage' %}"
           class="inline-flex items-center bg-white border border-emerald-200 text-emerald-600 hover:bg-emerald-50 px-4 py-2.5 rounded-xl font-semibold transition-all duration-200">
            <i class="fas fa-list mr-2"></i>
            Active Records
        </a>
        {% else %}
        <a href="{% url 'common:communities_manage' %}?archived=1"
           class="inline-flex items-center bg-white border border-amber-200 text-amber-600 hover:bg-amber-50 px-4 py-2.5 rounded-xl font-semibold transition-all duration-200">
            <i class="fas fa-archive mr-2"></i>
            Archived
        </a>
        {% endif %}
    </div>
</div>

<!-- Bulk Import Modal (hidden by default) -->
<div id="bulkImportModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/50" onclick="if(event.target === this) hideBulkImportModal()">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full mx-4" onclick="event.stopPropagation()">
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-5 rounded-t-2xl">
            <h3 class="text-xl font-bold text-white flex items-center gap-3">
                <i class="fas fa-file-import"></i>
                Bulk Import Communities
            </h3>
        </div>
        <div class="p-6 space-y-4">
            <p class="text-gray-700">Upload a CSV or Excel file to import multiple barangay OBC communities at once.</p>

            <div class="border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-purple-400 transition-colors">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                <p class="text-sm font-semibold text-gray-700 mb-2">Drag and drop your file here</p>
                <p class="text-xs text-gray-500 mb-4">or click to browse</p>
                <input type="file" id="bulkImportFile" accept=".csv,.xlsx,.xls" class="hidden" onchange="handleFileSelect(event)">
                <button type="button" onclick="document.getElementById('bulkImportFile').click()" class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                    <i class="fas fa-folder-open mr-2"></i>
                    Select File
                </button>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-blue-900 mb-2 flex items-center gap-2">
                    <i class="fas fa-info-circle"></i>
                    Template Format
                </h4>
                <p class="text-xs text-blue-800 mb-2">Download our template to ensure your data is formatted correctly:</p>
                <a href="/static/templates/communities_import_template.csv" download class="inline-flex items-center text-xs text-blue-700 font-semibold hover:text-blue-900">
                    <i class="fas fa-download mr-1"></i>
                    Download CSV Template
                </a>
            </div>
        </div>
        <div class="px-6 py-4 bg-gray-50 rounded-b-2xl flex items-center justify-end gap-3">
            <button type="button" onclick="hideBulkImportModal()" class="px-4 py-2 text-gray-700 font-semibold hover:bg-gray-200 rounded-lg transition-colors">
                Cancel
            </button>
            <button type="button" onclick="submitBulkImport()" class="px-4 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors">
                <i class="fas fa-upload mr-2"></i>
                Import
            </button>
        </div>
    </div>
</div>

<script>
function showBulkImportModal() {
    document.getElementById('bulkImportModal').classList.remove('hidden');
}

function hideBulkImportModal() {
    document.getElementById('bulkImportModal').classList.add('hidden');
}

function handleFileSelect(event) {
    const file = event.target.files[0];
    if (file) {
        console.log('Selected file:', file.name);
        // Show file name in UI (optional)
    }
}

function submitBulkImport() {
    const fileInput = document.getElementById('bulkImportFile');
    if (!fileInput.files.length) {
        alert('Please select a file to import.');
        return;
    }

    const formData = new FormData();
    formData.append('file', fileInput.files[0]);

    // Show loading state
    alert('Bulk import functionality will be implemented in backend. File: ' + fileInput.files[0].name);

    // TODO: Submit to backend endpoint
    // fetch('/communities/bulk-import/', { method: 'POST', body: formData })
    //   .then(response => response.json())
    //   .then(data => { ... });

    hideBulkImportModal();
}
</script>
