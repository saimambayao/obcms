{% extends 'base.html' %}

{% block title %}{{ organization.name }}{% if organization.acronym %} ({{ organization.acronym }}){% endif %} - Coordination System{% endblock %}

{% block breadcrumb %}
<li>
    <a href="{% url 'common:dashboard' %}" class="text-neutral-500 hover:text-neutral-700">Dashboard</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li>
    <a href="{% url 'common:coordination_home' %}" class="text-neutral-500 hover:text-neutral-700">Coordination</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li>
    <a href="{% url 'common:coordination_organizations' %}" class="text-neutral-500 hover:text-neutral-700">Organizations</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li class="text-neutral-800 font-semibold">{{ organization.name }}{% if organization.acronym %} ({{ organization.acronym }}){% endif %}</li>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-8">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
                <span class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow">
                    <i class="fas fa-building text-xl"></i>
                </span>
                <span>{{ organization.name }}{% if organization.acronym %} <span class="text-blue-600">({{ organization.acronym }})</span>{% endif %}</span>
            </h1>
            <div class="mt-3 flex flex-wrap items-center gap-3 text-sm text-gray-600">
                <span class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-gray-800 font-medium">
                    {{ organization.get_organization_type_display|default:"Type not specified" }}
                </span>
                {% if organization.partnership_status %}
                <span class="inline-flex items-center px-3 py-1 rounded-full {% if organization.partnership_status == 'active' %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                    Partnership Status: {{ organization.get_partnership_status_display|default:organization.partnership_status|title }}
                </span>
                {% endif %}
                <span class="inline-flex items-center px-3 py-1 rounded-full {% if organization.is_active %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                    <i class="fas {% if organization.is_active %}fa-check-circle{% else %}fa-times-circle{% endif %} mr-2"></i>
                    {% if organization.is_active %}Active{% else %}Inactive{% endif %}
                </span>
                {% if organization.is_priority %}
                <span class="inline-flex items-center px-3 py-1 rounded-full bg-indigo-100 text-indigo-800">
                    <i class="fas fa-star mr-2"></i>
                    Priority Partner
                </span>
                {% endif %}
            </div>
        </div>
        <div class="flex flex-wrap items-center gap-3">
            <a href="{{ return_url }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50">
                <i class="fas fa-arrow-left mr-2"></i>
                Back to directory
            </a>
            {% if perms.coordination.change_organization %}
            <a href="{% url 'common:coordination_organization_edit' organization.id %}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg shadow hover:bg-blue-700">
                <i class="fas fa-edit mr-2"></i>
                Edit details
            </a>
            {% endif %}
            {% if perms.coordination.delete_organization %}
            <a href="{% url 'common:coordination_organization_delete' organization.id %}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg shadow hover:bg-red-700">
                <i class="fas fa-trash mr-2"></i>
                Delete
            </a>
            {% endif %}
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
        <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6">
            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold">Total Contacts</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ contacts|length }}</p>
            <p class="mt-3 text-sm text-gray-500">Primary and supporting contacts maintained for this organization.</p>
        </div>
        <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6">
            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold">Related Partnerships</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ total_partnerships }}</p>
            <p class="mt-3 text-sm text-gray-500">{{ led_partnerships|length }} led â€¢ {{ member_partnerships|length }} participating</p>
        </div>
        <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6">
            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold">Partnership Level</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{{ organization.get_partnership_level_display|default:"Not set" }}</p>
            {% if organization.partnership_start_date %}
            <p class="mt-3 text-sm text-gray-500">Since {{ organization.partnership_start_date }}</p>
            {% endif %}
        </div>
        <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-6">
            <p class="text-xs uppercase tracking-wider text-gray-500 font-semibold">Last Engagement</p>
            <p class="mt-2 text-3xl font-bold text-gray-900">{% if organization.last_engagement_date %}{{ organization.last_engagement_date }}{% else %}Not recorded{% endif %}</p>
            <p class="mt-3 text-sm text-gray-500">Engagement frequency: {{ organization.get_engagement_frequency_display|default:"Not set" }}</p>
        </div>
    </div>

    <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
        <header class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
            <div class="flex items-center gap-3">
                <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-100 text-blue-600">
                    <i class="fas fa-id-card"></i>
                </span>
                <div>
                    <h2 class="text-lg font-semibold text-gray-900">Organization Overview</h2>
                    <p class="text-sm text-gray-500">Core profile, contact information, and operational notes.</p>
                </div>
            </div>
        </header>
        <div class="px-6 py-6 space-y-8">
            <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Full Name</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.name }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Acronym</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.acronym|default:"&mdash;" }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Primary Address</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.address|default:"&mdash;" }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Mailing Address</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.mailing_address|default:"&mdash;" }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Email</dt>
                    <dd class="mt-1 text-base">
                        {% if organization.email %}
                        <a href="mailto:{{ organization.email }}" class="text-blue-600 hover:text-blue-700">{{ organization.email }}</a>
                        {% else %}
                        <span class="text-gray-900">&mdash;</span>
                        {% endif %}
                    </dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Phone</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.phone|default:organization.mobile|default:"&mdash;" }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Website</dt>
                    <dd class="mt-1 text-base">
                        {% if organization.website %}
                        <a href="{{ organization.website }}" class="text-blue-600 hover:text-blue-700" target="_blank" rel="noopener">{{ organization.website }}</a>
                        {% else %}
                        <span class="text-gray-900">&mdash;</span>
                        {% endif %}
                    </dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Geographic Coverage</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.geographic_coverage|default:"&mdash;" }}</dd>
                </div>
            </dl>

            {% if organization.mandate or organization.powers_and_functions %}
            <div class="border-t border-gray-200 pt-6 space-y-6">
                {% if organization.mandate %}
                <div>
                    <dt class="text-sm font-semibold text-gray-600 flex items-center gap-2">
                        <i class="fas fa-gavel text-teal-600"></i>
                        Mandate
                    </dt>
                    <dd class="mt-2 text-base text-gray-900 whitespace-pre-line bg-teal-50 border border-teal-200 rounded-lg p-4">{{ organization.mandate }}</dd>
                </div>
                {% endif %}

                {% if organization.powers_and_functions %}
                <div>
                    <dt class="text-sm font-semibold text-gray-600 flex items-center gap-2">
                        <i class="fas fa-list-check text-cyan-600"></i>
                        Powers and Functions
                    </dt>
                    <dd class="mt-2 text-base text-gray-900 whitespace-pre-line bg-cyan-50 border border-cyan-200 rounded-lg p-4">{{ organization.powers_and_functions }}</dd>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Head of Organization</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.head_of_organization|default:"&mdash;" }}</dd>
                    {% if organization.head_position %}
                    <p class="text-sm text-gray-500">{{ organization.head_position }}</p>
                    {% endif %}
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">OOBC Focal Person</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.focal_person|default:"&mdash;" }}</dd>
                    {% if organization.focal_person_position or organization.focal_person_contact %}
                    <p class="text-sm text-gray-500">{{ organization.focal_person_position|default:"" }}{% if organization.focal_person_contact %}{% if organization.focal_person_position %} â€¢ {% endif %}{{ organization.focal_person_contact }}{% endif %}</p>
                    {% endif %}
                    {% if organization.focal_person_email %}
                    <p class="text-sm"><a class="text-blue-600 hover:text-blue-700" href="mailto:{{ organization.focal_person_email }}">{{ organization.focal_person_email }}</a></p>
                    {% endif %}
                </div>
            </dl>

            <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Areas of Expertise</dt>
                    <dd class="mt-1 text-base text-gray-900 whitespace-pre-line">{{ organization.areas_of_expertise|default:"&mdash;" }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Target Beneficiaries</dt>
                    <dd class="mt-1 text-base text-gray-900 whitespace-pre-line">{{ organization.target_beneficiaries|default:"&mdash;" }}</dd>
                </div>
            </dl>

            <dl class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Registration Number</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.registration_number|default:"&mdash;" }}</dd>
                </div>
                <div>
                    <dt class="text-sm font-semibold text-gray-600">Tax Identification Number</dt>
                    <dd class="mt-1 text-base text-gray-900">{{ organization.tax_identification_number|default:"&mdash;" }}</dd>
                </div>
            </dl>

            {% if organization.social_media %}
            <div>
                <dt class="text-sm font-semibold text-gray-600">Social Media</dt>
                <dd class="mt-2">
                    <ul class="space-y-2 text-sm text-gray-700">
                        {% for platform, link in organization.social_media.items %}
                        <li class="flex items-center gap-3">
                            <span class="inline-flex items-center px-3 py-1 rounded-full bg-gray-100 text-gray-700 uppercase tracking-wide text-xs font-semibold">{{ platform }}</span>
                            {% if link %}
                            <a href="{{ link }}" class="text-blue-600 hover:text-blue-700" target="_blank" rel="noopener">{{ link }}</a>
                            {% else %}
                            <span class="text-gray-500">Not provided</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </dd>
            </div>
            {% endif %}

            {% if organization.notes %}
            <div>
                <dt class="text-sm font-semibold text-gray-600">Notes</dt>
                <dd class="mt-2 text-sm text-gray-700 whitespace-pre-line">{{ organization.notes }}</dd>
            </div>
            {% endif %}
        </div>
    </section>

    <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
        <header class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
            <div class="flex items-center gap-3">
                <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-teal-100 text-teal-600">
                    <i class="fas fa-users"></i>
                </span>
                <div>
                    <h2 class="text-lg font-semibold text-gray-900">Contacts</h2>
                    <p class="text-sm text-gray-500">Primary and secondary contacts managing coordination touchpoints.</p>
                </div>
            </div>
            <a href="{% url 'common:coordination_organization_edit' organization.id %}#contacts-container" class="text-sm font-medium text-blue-600 hover:text-blue-700">Manage contacts</a>
        </header>
        <div class="px-6 py-6 space-y-6">
            {% if contacts %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for contact in contacts %}
                <article class="border border-gray-200 rounded-xl shadow-sm p-5 bg-gray-50">
                    <div class="flex items-start justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">{{ contact.display_name }}</h3>
                            <p class="text-sm text-gray-500">{{ contact.position }}{% if contact.department %} â€¢ {{ contact.department }}{% endif %}</p>
                            <p class="mt-1 text-xs uppercase tracking-wide text-gray-500">{{ contact.get_contact_type_display }}</p>
                        </div>
                        <div class="flex flex-col items-end gap-2">
                            {% if contact.is_primary %}
                            <span class="inline-flex items-center px-3 py-1 text-xs font-semibold text-white bg-blue-600 rounded-full">Primary</span>
                            {% endif %}
                            {% if not contact.is_active %}
                            <span class="inline-flex items-center px-3 py-1 text-xs font-semibold text-white bg-gray-500 rounded-full">Inactive</span>
                            {% endif %}
                        </div>
                    </div>
                    <ul class="mt-4 space-y-2 text-sm text-gray-700">
                        {% if contact.email %}
                        <li><i class="fas fa-envelope mr-2 text-gray-400"></i><a href="mailto:{{ contact.email }}" class="text-blue-600 hover:text-blue-700">{{ contact.email }}</a></li>
                        {% endif %}
                        {% if contact.alternative_email %}
                        <li><i class="fas fa-at mr-2 text-gray-400"></i><a href="mailto:{{ contact.alternative_email }}" class="text-blue-600 hover:text-blue-700">{{ contact.alternative_email }}</a></li>
                        {% endif %}
                        {% if contact.phone %}
                        <li><i class="fas fa-phone mr-2 text-gray-400"></i>{{ contact.phone }}</li>
                        {% endif %}
                        {% if contact.mobile %}
                        <li><i class="fas fa-mobile-alt mr-2 text-gray-400"></i>{{ contact.mobile }}</li>
                        {% endif %}
                        {% if contact.preferred_communication_method %}
                        <li><i class="fas fa-comments mr-2 text-gray-400"></i>Prefers {{ contact.get_preferred_communication_method_display }}</li>
                        {% endif %}
                        {% if contact.best_contact_time %}
                        <li><i class="fas fa-clock mr-2 text-gray-400"></i>{{ contact.best_contact_time }}</li>
                        {% endif %}
                    </ul>
                    {% if contact.areas_of_responsibility %}
                    <p class="mt-4 text-sm text-gray-600"><span class="font-semibold">Responsibilities:</span> {{ contact.areas_of_responsibility }}</p>
                    {% endif %}
                    {% if contact.languages_spoken %}
                    <p class="mt-1 text-sm text-gray-600"><span class="font-semibold">Languages:</span> {{ contact.languages_spoken }}</p>
                    {% endif %}
                    {% if contact.notes %}
                    <p class="mt-1 text-sm text-gray-600"><span class="font-semibold">Notes:</span> {{ contact.notes }}</p>
                    {% endif %}
                </article>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-sm text-gray-500">No contacts recorded yet. Use the edit action to add contact information.</p>
            {% endif %}
        </div>
    </section>

    <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
        <header class="flex items-center gap-3 px-6 py-4 border-b border-gray-200">
            <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-purple-100 text-purple-600">
                <i class="fas fa-handshake"></i>
            </span>
            <div>
                <h2 class="text-lg font-semibold text-gray-900">Partnerships</h2>
                <p class="text-sm text-gray-500">Active agreements and collaborations involving this organization.</p>
            </div>
        </header>
        <div class="px-6 py-6 space-y-6">
            <div>
                <h3 class="text-md font-semibold text-gray-800 flex items-center gap-2">
                    <i class="fas fa-flag text-blue-500"></i>
                    Led partnerships
                </h3>
                {% if led_partnerships %}
                <ul class="mt-3 space-y-3">
                    {% for partnership in led_partnerships %}
                    <li class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ partnership.title }}</p>
                                <p class="text-sm text-gray-500">Status: {{ partnership.get_status_display|default:partnership.status|title }}</p>
                            </div>
                            <a href="{% url 'common:coordination_partnerships' %}?search={{ partnership.title|urlencode }}" class="text-sm font-medium text-blue-600 hover:text-blue-700">View partnership</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="mt-2 text-sm text-gray-500">No partnerships led by this organization.</p>
                {% endif %}
            </div>

            <div>
                <h3 class="text-md font-semibold text-gray-800 flex items-center gap-2">
                    <i class="fas fa-users text-green-500"></i>
                    Participating partnerships
                </h3>
                {% if member_partnerships %}
                <ul class="mt-3 space-y-3">
                    {% for partnership in member_partnerships %}
                    <li class="border border-gray-200 rounded-lg p-4 bg-gray-50">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ partnership.title }}</p>
                                <p class="text-sm text-gray-500">Lead: {{ partnership.lead_organization.display_name|default:partnership.lead_organization.name }}</p>
                            </div>
                            <a href="{% url 'common:coordination_partnerships' %}?search={{ partnership.title|urlencode }}" class="text-sm font-medium text-blue-600 hover:text-blue-700">View partnership</a>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="mt-2 text-sm text-gray-500">No additional partnerships recorded.</p>
                {% endif %}
            </div>
        </div>
    </section>
</div>
{% endblock %}
