<!-- Stakeholder Matching Widget -->
<div class="bg-white rounded-xl shadow border p-6">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold flex items-center">
            <i class="fas fa-handshake text-blue-600 mr-2"></i>
            Recommended Stakeholders
        </h3>
        <span class="text-sm text-gray-500">{{ stakeholder_matches|length }} matches found</span>
    </div>

    {% if stakeholder_matches %}
    <div class="space-y-3">
        {% for match in stakeholder_matches %}
        <div class="border rounded-lg p-4 hover:bg-gray-50 transition-colors duration-200">
            <!-- Match Header -->
            <div class="flex justify-between items-start mb-2">
                <div class="flex-1">
                    <h4 class="font-semibold text-gray-900">{{ match.stakeholder.name }}</h4>
                    <p class="text-sm text-gray-600">{{ match.stakeholder.get_organization_type_display }}</p>
                </div>
                <div class="text-right ml-4">
                    <div class="flex items-center">
                        <span class="text-2xl font-bold text-emerald-600">{{ match.match_score|floatformat:0 }}%</span>
                    </div>
                    <p class="text-xs text-gray-500">Match Score</p>
                </div>
            </div>

            <!-- Rationale -->
            <div class="mb-3">
                <p class="text-sm text-gray-700">{{ match.rationale }}</p>
            </div>

            <!-- Matching Criteria Tags -->
            <div class="flex flex-wrap gap-2 mb-3">
                {% for criterion in match.matching_criteria %}
                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full">
                    <i class="fas fa-check-circle mr-1"></i>{{ criterion|title }}
                </span>
                {% endfor %}
            </div>

            <!-- Organization Details -->
            <div class="flex flex-wrap gap-4 mb-3 text-sm text-gray-600">
                {% if match.stakeholder.geographic_coverage %}
                <div class="flex items-center">
                    <i class="fas fa-map-marked-alt text-gray-400 mr-1"></i>
                    <span>{{ match.stakeholder.geographic_coverage|truncatewords:5 }}</span>
                </div>
                {% endif %}

                {% if match.stakeholder.annual_budget %}
                <div class="flex items-center">
                    <i class="fas fa-wallet text-gray-400 mr-1"></i>
                    <span>â‚±{{ match.stakeholder.annual_budget|floatformat:0|intcomma }}</span>
                </div>
                {% endif %}

                {% if match.stakeholder.staff_count %}
                <div class="flex items-center">
                    <i class="fas fa-users text-gray-400 mr-1"></i>
                    <span>{{ match.stakeholder.staff_count }} staff</span>
                </div>
                {% endif %}
            </div>

            <!-- Actions -->
            <div class="flex gap-2">
                <button
                    onclick="initiatePartnership('{{ match.stakeholder.id }}', '{{ community_id }}', '{{ need_category }}')"
                    class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-200 text-sm font-medium">
                    <i class="fas fa-handshake mr-2"></i>Initiate Partnership
                </button>
                <a
                    href="{% url 'coordination:organization_detail' match.stakeholder.id %}"
                    class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 text-sm font-medium">
                    <i class="fas fa-info-circle"></i>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-8">
        <i class="fas fa-search text-gray-300 text-4xl mb-3"></i>
        <p class="text-gray-500">No matching stakeholders found for this need category.</p>
        <button
            onclick="adjustMatchingCriteria()"
            class="mt-4 text-blue-600 hover:text-blue-700 text-sm font-medium">
            Adjust Matching Criteria
        </button>
    </div>
    {% endif %}
</div>

<script>
function initiatePartnership(stakeholderId, communityId, needCategory) {
    // Show confirmation modal
    if (confirm('Initiate partnership with this stakeholder?')) {
        // Redirect to partnership creation form with pre-filled data
        window.location.href = `/coordination/partnerships/create/?stakeholder=${stakeholderId}&community=${communityId}&category=${needCategory}`;
    }
}

function adjustMatchingCriteria() {
    // Open modal or redirect to matching settings
    alert('Matching criteria adjustment coming soon!');
}
</script>
