{#
Reusable Task Card Component

Expected context:
- task: task object with attributes:
    - id: task ID
    - title: task title
    - description: optional description
    - status: task status (planning, in_progress, review, completed)
    - priority: priority level (low, medium, high)
    - due_date: due date
    - assigned_to: user object
    - domain: optional domain/category
    - is_overdue: boolean computed property
- show_actions: boolean, show action buttons (default: False)
- detail_url: optional URL for task detail modal

Usage:
{% include "components/task_card.html" with task=task %}

For kanban board usage:
{% include "components/task_card.html" with task=task show_actions=False %}
#}
{% load static %}

<div class="task-card-content" id="item-{{ task.id }}-title">
    {# Title #}
    <h4 class="font-semibold text-gray-900 mb-2 text-sm leading-tight">
        {{ task.title|truncatewords:12 }}
    </h4>

    {# Description (optional, truncated) #}
    {% if task.description %}
    <p class="text-xs text-gray-600 mb-3 line-clamp-2">
        {{ task.description|truncatewords:15 }}
    </p>
    {% endif %}

    {# Meta Information #}
    <div class="flex flex-wrap items-center gap-2 text-xs text-gray-600 mb-3">
        {# Assignee #}
        {% if task.assigned_to %}
        <div class="flex items-center bg-gray-100 rounded-full px-2 py-1">
            <i class="fas fa-user text-gray-400 mr-1" aria-hidden="true"></i>
            <span class="truncate max-w-[120px]">{{ task.assigned_to.get_full_name|default:task.assigned_to.username }}</span>
        </div>
        {% endif %}

        {# Due Date #}
        {% if task.due_date %}
        <div class="flex items-center {% if task.is_overdue %}bg-red-100 text-red-700{% else %}bg-blue-100 text-blue-700{% endif %} rounded-full px-2 py-1">
            <i class="fas fa-calendar {% if task.is_overdue %}fa-exclamation-triangle{% endif %} mr-1" aria-hidden="true"></i>
            <span class="{% if task.is_overdue %}font-semibold{% endif %}">
                {{ task.due_date|date:"M d" }}
            </span>
        </div>
        {% endif %}
    </div>

    {# Badges #}
    <div class="flex flex-wrap items-center gap-2 mb-2">
        {# Priority Badge #}
        {% if task.priority == 'high' %}
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800">
            <i class="fas fa-exclamation-circle mr-1" aria-hidden="true"></i>High
        </span>
        {% elif task.priority == 'medium' %}
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
            <i class="fas fa-circle mr-1" aria-hidden="true"></i>Medium
        </span>
        {% elif task.priority == 'low' %}
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">
            <i class="fas fa-circle mr-1" aria-hidden="true"></i>Low
        </span>
        {% endif %}

        {# Domain Badge #}
        {% if task.domain %}
        <span class="inline-flex items-center px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800">
            {{ task.get_domain_display }}
        </span>
        {% endif %}

        {# Status Badge (for table/list view) #}
        {% if show_status_badge %}
        <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full
            {% if task.status == 'completed' %}bg-green-100 text-green-800
            {% elif task.status == 'in_progress' %}bg-blue-100 text-blue-800
            {% elif task.status == 'review' %}bg-purple-100 text-purple-800
            {% else %}bg-gray-100 text-gray-800{% endif %}">
            {{ task.get_status_display }}
        </span>
        {% endif %}
    </div>

    {# Action Buttons (optional) #}
    {% if show_actions %}
    <div class="flex items-center gap-2 mt-3 pt-3 border-t border-gray-200">
        {% if detail_url %}
        <button type="button"
                class="flex-1 text-xs font-medium text-blue-600 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 rounded px-2 py-1"
                hx-get="{{ detail_url }}"
                hx-target="#modal-container"
                hx-swap="innerHTML"
                aria-label="View task details">
            <i class="fas fa-eye mr-1" aria-hidden="true"></i>View
        </button>
        {% endif %}

        {% if task.edit_url %}
        <a href="{{ task.edit_url }}"
           class="flex-1 text-xs font-medium text-indigo-600 hover:text-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-1 rounded px-2 py-1 text-center"
           aria-label="Edit task">
            <i class="fas fa-pen mr-1" aria-hidden="true"></i>Edit
        </a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
/* Line clamp for description */
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Smooth transitions */
.task-card-content {
    transition: all 200ms ease-in-out;
}

/* Hover effect for clickable cards */
.kanban-item:hover .task-card-content,
.task-card-content:hover {
    transform: translateY(-1px);
}
</style>
