<!-- Modern Calendar Component (Refactored) -->
<!-- Clean architecture using CSS Grid for predictable layout -->

<div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
    <!-- Calendar Header -->
    <div class="bg-gradient-to-r from-blue-600 to-emerald-600 px-6 py-4">
        <h2 class="text-xl font-bold text-white flex items-center">
            <i class="fas fa-calendar-alt mr-3"></i>
            Modern Calendar View
        </h2>
        <p class="text-white/90 text-sm mt-1">Interactive calendar with multiple view options</p>
    </div>

    <!-- Main Calendar Container - CSS Grid Layout -->
    <div class="calendar-grid-container">
        <!-- Sidebar (Left) - Fixed 320px width -->
        <aside id="calendarSidebar" class="calendar-sidebar">
            <!-- Mini Calendar -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-sm font-semibold text-gray-800" id="miniCalendarMonth"></h3>
                        <div class="flex space-x-1">
                            <button id="miniCalPrev" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center transition-colors" aria-label="Previous month">
                                <i class="fas fa-chevron-left text-gray-600 text-sm"></i>
                            </button>
                            <button id="miniCalNext" class="w-8 h-8 rounded-lg hover:bg-gray-100 flex items-center justify-center transition-colors" aria-label="Next month">
                                <i class="fas fa-chevron-right text-gray-600 text-sm"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Mini Calendar Grid -->
                    <div class="grid grid-cols-7 gap-1 text-center">
                        <!-- Day headers -->
                        <div class="text-xs font-medium text-gray-500 py-1">S</div>
                        <div class="text-xs font-medium text-gray-500 py-1">M</div>
                        <div class="text-xs font-medium text-gray-500 py-1">T</div>
                        <div class="text-xs font-medium text-gray-500 py-1">W</div>
                        <div class="text-xs font-medium text-gray-500 py-1">T</div>
                        <div class="text-xs font-medium text-gray-500 py-1">F</div>
                        <div class="text-xs font-medium text-gray-500 py-1">S</div>

                        <!-- Calendar dates will be populated by JavaScript -->
                        <div id="miniCalendarDates" class="contents">
                            <!-- JavaScript will populate dates here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upcoming Events List -->
            <div class="bg-white rounded-xl border border-gray-200 shadow-sm">
                <div class="p-4 border-b border-gray-200">
                    <h3 class="text-sm font-semibold text-gray-800 flex items-center">
                        <i class="fas fa-list-ul text-blue-600 mr-2"></i>
                        Upcoming Events
                    </h3>
                </div>
                <div id="upcomingEventsList" class="p-4 space-y-3 max-h-96 overflow-y-auto">
                    <!-- Events will be populated by JavaScript -->
                    <div class="text-sm text-gray-500 text-center py-4">
                        <i class="fas fa-calendar-day text-gray-400 text-2xl mb-2"></i>
                        <p>Loading events...</p>
                    </div>
                </div>
            </div>

            <!-- Mobile Sidebar Toggle -->
            <button id="mobileSidebarToggle" class="lg:hidden w-full px-4 py-2 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-lg font-medium hover:shadow-lg transition-all">
                <i class="fas fa-times mr-2"></i>
                Close Sidebar
            </button>
        </aside>

        <!-- Main Calendar Area (Right) - Takes remaining space -->
        <main class="calendar-main-area">
            <!-- Calendar Controls -->
            <div class="calendar-controls">
                <!-- View Switcher -->
                <div class="flex items-center space-x-2 bg-gray-100 rounded-xl p-1">
                    <button data-view="timeGridDay" class="calendar-view-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-white transition-all">
                        Day
                    </button>
                    <button data-view="timeGridWeek" class="calendar-view-btn active px-4 py-2 rounded-lg text-sm font-medium text-white bg-gradient-to-r from-blue-500 to-emerald-500 transition-all">
                        Week
                    </button>
                    <button data-view="dayGridMonth" class="calendar-view-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-white transition-all">
                        Month
                    </button>
                    <button data-view="multiMonthYear" class="calendar-view-btn px-4 py-2 rounded-lg text-sm font-medium text-gray-700 hover:bg-white transition-all">
                        Year
                    </button>
                </div>

                <!-- Search Bar -->
                <div class="relative flex-1 max-w-xs">
                    <input type="text"
                           id="calendarSearch"
                           placeholder="Search events..."
                           class="w-full pl-10 pr-4 py-2 text-sm rounded-xl border border-gray-200 focus:ring-emerald-500 focus:border-emerald-500 transition-all">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                </div>
            </div>

            <!-- Navigation Controls -->
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <button id="calendarPrev" class="px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="calendarToday" class="px-4 py-2 border-2 border-blue-500 text-blue-600 rounded-xl hover:bg-blue-50 font-semibold transition-colors">
                        Today
                    </button>
                    <button id="calendarNext" class="px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <h2 id="calendarTitle" class="text-xl font-bold text-gray-800"></h2>
            </div>

            <!-- FullCalendar Container - Fixed height, no flex conflicts -->
            <div id="modernCalendar" class="calendar-container">
                <!-- FullCalendar will render here -->
            </div>

            <!-- Mobile Sidebar Open Button -->
            <button id="mobileSidebarOpen" class="lg:hidden fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-full shadow-lg flex items-center justify-center hover:shadow-xl transition-all z-40">
                <i class="fas fa-bars text-xl"></i>
            </button>
        </main>
    </div>
</div>

<style>
/* ===================================================================
   MODERN CALENDAR - REFACTORED CSS
   Using CSS Grid for predictable layout, no flex conflicts
   =================================================================== */

/* Main Grid Container - Desktop: Sidebar (320px) + Main (remaining space) */
.calendar-grid-container {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 0;
    min-height: 800px;
}

/* Sidebar - Fixed 320px width, scrollable */
.calendar-sidebar {
    width: 320px;
    background-color: #f9fafb;
    border-right: 1px solid #e5e7eb;
    padding: 1.5rem;
    overflow-y: auto;
    max-height: 900px;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Main Calendar Area - Takes remaining space */
.calendar-main-area {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

/* Calendar Controls */
.calendar-controls {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1rem;
}

@media (min-width: 640px) {
    .calendar-controls {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
    }
}

/* FullCalendar Container - Fixed height, clean container */
.calendar-container {
    background-color: white;
    border-radius: 0.75rem;
    border: 1px solid #e5e7eb;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    height: 700px;
    width: 100%;
    overflow: hidden;
}

/* ===================================================================
   MINI CALENDAR STYLES
   =================================================================== */

.mini-cal-date {
    width: 100%;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.mini-cal-date:hover {
    background-color: #f3f4f6;
}

.mini-cal-date.today {
    background-color: #dbeafe;
    color: #1e40af;
    font-weight: 600;
}

.mini-cal-date.selected {
    background-color: #059669;
    color: white;
    font-weight: 600;
}

.mini-cal-date.other-month {
    color: #d1d5db;
}

.mini-cal-date.has-events::after {
    content: '';
    position: absolute;
    bottom: 4px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    background-color: #059669;
    border-radius: 50%;
}

.mini-cal-date.has-events.today::after {
    background-color: #1e40af;
}

.mini-cal-date.has-events.selected::after {
    background-color: white;
}

/* ===================================================================
   VIEW SWITCHER BUTTONS
   =================================================================== */

.calendar-view-btn.active {
    background: linear-gradient(135deg, #1e40af 0%, #059669 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
}

/* ===================================================================
   FULLCALENDAR CUSTOMIZATION - Minimal overrides
   =================================================================== */

/* Let FullCalendar handle its own layout - just set container size */
#modernCalendar .fc {
    height: 100%;
    width: 100%;
}

/* Custom toolbar styles */
#modernCalendar .fc-toolbar-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
}

#modernCalendar .fc-button {
    background: linear-gradient(135deg, #1e40af 0%, #059669 100%);
    border: none;
    border-radius: 0.75rem;
    padding: 0.5rem 1rem;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#modernCalendar .fc-button:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

#modernCalendar .fc-button:disabled {
    opacity: 0.5;
}

/* Day/Week headers */
#modernCalendar .fc-col-header-cell {
    background-color: #f9fafb;
    font-weight: 600;
    color: #374151;
    padding: 0.75rem 0.5rem;
}

/* Today highlighting */
#modernCalendar .fc-daygrid-day.fc-day-today {
    background-color: #dbeafe;
}

/* Time slots */
#modernCalendar .fc-timegrid-slot {
    height: 3rem;
}

#modernCalendar .fc-timegrid-slot-label {
    font-size: 0.8rem;
    color: #6b7280;
    padding-right: 0.5rem;
}

/* Grid borders */
#modernCalendar .fc-scrollgrid {
    border-color: #e5e7eb;
}

/* Event styling */
#modernCalendar .fc-event {
    border-radius: 0.5rem;
    border-left-width: 3px;
    padding: 0.375rem 0.625rem;
    font-size: 0.8125rem;
    cursor: pointer;
    transition: all 0.2s;
}

#modernCalendar .fc-event:hover {
    opacity: 0.9;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

#modernCalendar .fc-event-title {
    font-weight: 600;
    line-height: 1.3;
}

#modernCalendar .fc-event-time {
    font-weight: 500;
    font-size: 0.75rem;
    opacity: 0.9;
}

/* ===================================================================
   RESPONSIVE DESIGN - Mobile/Tablet
   =================================================================== */

/* Tablet: Stack sidebar below calendar controls */
@media (max-width: 1023px) {
    .calendar-grid-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
    }

    .calendar-sidebar {
        position: fixed;
        top: 0;
        left: -100%;
        width: 320px;
        height: 100vh;
        z-index: 50;
        transition: left 0.3s ease-in-out;
        border-right: 1px solid #e5e7eb;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
    }

    .calendar-sidebar.open {
        left: 0;
    }

    .calendar-main-area {
        grid-column: 1;
    }
}

/* Mobile: Smaller calendar container */
@media (max-width: 767px) {
    .calendar-container {
        height: 600px;
    }

    .calendar-grid-container {
        min-height: 650px;
    }

    .calendar-controls {
        gap: 0.75rem;
    }

    .calendar-view-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.8125rem;
    }
}

/* Extra small mobile: Compact layout */
@media (max-width: 479px) {
    .calendar-container {
        height: 500px;
    }

    .calendar-sidebar {
        width: 280px;
    }

    .calendar-main-area {
        padding: 1rem;
    }

    .calendar-view-btn {
        padding: 0.5rem;
        font-size: 0.75rem;
    }
}
</style>
