{% extends "admin/base.html" %}
{% load i18n static %}

{% block title %}{% trans 'Site administration' %} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block bodyclass %}{{ block.super }} dashboard-home{% endblock %}

{% block content_title %}{% endblock %}
{% block content_subtitle %}{% endblock %}
{% block object-tools %}{% endblock %}

{% block branding %}
<h1 id="site-name"><a href="{% url 'admin:index' %}">{% trans 'OBC Management System' %} - {% trans 'Admin Panel' %}</a></h1>
{% endblock %}

{% block nav-global %}{% endblock %}

{% block content %}
{% with managed_count=app_list|length %}
<div class="obc-dashboard-shell">
    <section class="obc-dashboard__hero">
        <header class="obc-dashboard__hero-mast">
            <div class="obc-dashboard__hero-mast-primary">
                <span class="obc-dashboard__hero-mast-icon"><i class="fas fa-compass"></i></span>
                <div class="obc-dashboard__hero-mast-copy">
                    <span class="obc-dashboard__badge">{% trans "Admin HQ" %}</span>
                    <h1 class="obc-dashboard__title">{% trans "Keep Barangay OBC momentum going" %}</h1>
                    <p class="obc-dashboard__lead">
                        {% blocktrans with name=user.get_full_name|default:user.username %}
                        Coordinate ministries, documents, and frontline reports from a single command center tailored for Barangay OBC operations.
                        {% endblocktrans %}
                    </p>
                </div>
            </div>
            <div class="obc-dashboard__hero-actions">
                <a class="obc-hero-button obc-hero-button--primary" href="#quick-actions">
                    <i class="fas fa-bolt"></i>
                    {% trans "Jump to quick actions" %}
                </a>
                {% if user.is_staff %}
                <a class="obc-hero-button obc-hero-button--ghost" href="{% url 'common:dashboard' %}">
                    <i class="fas fa-chart-line"></i>
                    {% trans "View frontline dashboard" %}
                </a>
                {% endif %}
            </div>
        </header>
        <div class="obc-dashboard__hero-highlights">
            <article class="obc-dashboard-highlight obc-dashboard-highlight--indigo">
                <span class="obc-dashboard-highlight__icon"><i class="fas fa-wand-magic-sparkles"></i></span>
                <div>
                    <h3 class="obc-dashboard-highlight__title">{% trans "Instant UI" %}</h3>
                    <p class="obc-dashboard-highlight__meta">{% trans "HTMX ready responses" %}</p>
                </div>
            </article>
            <article class="obc-dashboard-highlight obc-dashboard-highlight--emerald">
                <span class="obc-dashboard-highlight__icon"><i class="fas fa-users"></i></span>
                <div>
                    <h3 class="obc-dashboard-highlight__title">{% trans "Community focus" %}</h3>
                    <p class="obc-dashboard-highlight__meta">{% trans "Provincial to barangay coverage" %}</p>
                </div>
            </article>
            <article class="obc-dashboard-highlight obc-dashboard-highlight--sky">
                <span class="obc-dashboard-highlight__icon"><i class="fas fa-shield-halved"></i></span>
                <div>
                    <h3 class="obc-dashboard-highlight__title">{% trans "Safeguarded data" %}</h3>
                    <p class="obc-dashboard-highlight__meta">{% trans "Policy tracking & audits" %}</p>
                </div>
            </article>
        </div>
        <div class="obc-dashboard-metrics">
            <div class="obc-dashboard-metric">
                <span class="obc-dashboard-metric__label">{% trans "Managed apps" %}</span>
                <strong class="obc-dashboard-metric__value">{{ managed_count }}</strong>
                <span class="obc-dashboard-metric__hint">{% trans "Modules connected to admin" %}</span>
            </div>
            <div class="obc-dashboard-metric">
                <span class="obc-dashboard-metric__label">{% trans "Signed in as" %}</span>
                <strong class="obc-dashboard-metric__value">{{ user.get_full_name|default:user.username }}</strong>
                <span class="obc-dashboard-metric__hint">{% trans "Authorized staff account" %}</span>
            </div>
            <div class="obc-dashboard-metric">
                <span class="obc-dashboard-metric__label">{% trans "Last login" %}</span>
                <strong class="obc-dashboard-metric__value">
                    {% if user.last_login %}{{ user.last_login|timesince }}{% else %}{% trans "First session" %}{% endif %}
                </strong>
                <span class="obc-dashboard-metric__hint">{% now "M d, Y H:i" %}</span>
            </div>
        </div>
    </section>

    <section id="quick-actions" class="obc-dashboard-section">
        <header class="obc-dashboard-section__header">
            <div>
                <h2 class="obc-dashboard-section__title">
                    <i class="fas fa-bolt"></i>
                    {% trans "Quick Actions" %}
                </h2>
                <p class="obc-dashboard-section__subtitle">{% trans "Fast lanes for the tasks you reach for every day." %}</p>
            </div>
        </header>
        <div class="obc-quick-grid">
            <a href="/admin/common/user/add/" class="obc-quick-card obc-quick-card--indigo">
                <span class="obc-quick-card__icon"><i class="fas fa-user-plus"></i></span>
                <h3 class="obc-quick-card__title">{% trans "Invite a staff user" %}</h3>
                <p class="obc-quick-card__meta">{% trans "Provision access with the latest Barangay OBC permissions." %}</p>
                <span class="obc-quick-card__cta">{% trans "Create user" %} <i class="fas fa-arrow-right"></i></span>
            </a>
            <a href="{% url 'common:dashboard' %}" class="obc-quick-card obc-quick-card--emerald">
                <span class="obc-quick-card__icon"><i class="fas fa-map-location-dot"></i></span>
                <h3 class="obc-quick-card__title">{% trans "Return to frontline view" %}</h3>
                <p class="obc-quick-card__meta">{% trans "Sync with live community operations and status boards." %}</p>
                <span class="obc-quick-card__cta">{% trans "Launch dashboard" %} <i class="fas fa-arrow-right"></i></span>
            </a>
            <a href="/admin/auth/group/" class="obc-quick-card obc-quick-card--magenta">
                <span class="obc-quick-card__icon"><i class="fas fa-user-shield"></i></span>
                <h3 class="obc-quick-card__title">{% trans "Tune access controls" %}</h3>
                <p class="obc-quick-card__meta">{% trans "Refresh groups, assign capabilities, and secure every workflow." %}</p>
                <span class="obc-quick-card__cta">{% trans "Manage groups" %} <i class="fas fa-arrow-right"></i></span>
            </a>
        </div>
    </section>

    {% if app_list %}
    <section class="obc-dashboard-section">
        <header class="obc-dashboard-section__header">
            <div>
                <h2 class="obc-dashboard-section__title">
                    <i class="fas fa-th-large"></i>
                    {% trans "Application Models" %}
                </h2>
                <p class="obc-dashboard-section__subtitle">{% trans "Browse every module that powers Barangay OBC programs." %}</p>
            </div>
        </header>
        <div class="obc-app-grid">
            {% for app in app_list %}
            <div class="obc-app-card">
                <div class="obc-app-card__header">
                    <div class="obc-app-card__heading">
                        <span class="obc-app-card__icon">
                            {% if app.app_label == 'common' %}<i class="fas fa-cog"></i>
                            {% elif app.app_label == 'communities' %}<i class="fas fa-users"></i>
                            {% elif app.app_label == 'mana' %}<i class="fas fa-map"></i>
                            {% elif app.app_label == 'coordination' %}<i class="fas fa-handshake"></i>
                            {% elif app.app_label == 'policy_tracking' %}<i class="fas fa-lightbulb"></i>
                            {% elif app.app_label == 'documents' %}<i class="fas fa-file-alt"></i>
                            {% elif app.app_label == 'ai_assistant' %}<i class="fas fa-robot"></i>
                            {% else %}<i class="fas fa-database"></i>{% endif %}
                        </span>
                        <div>
                            <p class="obc-app-card__title">{{ app.name }}</p>
                            <span class="obc-app-card__subtitle">{{ app.app_label }}</span>
                        </div>
                    </div>
                    {% if app.app_url %}
                    <a href="{{ app.app_url }}" class="obc-app-card__link">
                        <i class="fas fa-arrow-up-right-from-square"></i>
                        {% trans "View app" %}
                    </a>
                    {% endif %}
                </div>
                <div class="obc-app-card__body">
                    {% for model in app.models %}
                    <div class="obc-app-card__row">
                        <div class="obc-app-card__row-meta">
                            <span class="obc-app-card__row-icon"><i class="fas fa-table"></i></span>
                            <div>
                                <p class="obc-app-card__row-title">{{ model.name }}</p>
                                {% if model.object_name %}
                                <p class="obc-app-card__row-hint">{{ model.object_name }}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="obc-app-card__row-actions">
                            {% if model.admin_url %}
                            <a href="{{ model.admin_url }}" class="obc-app-card__action obc-app-card__action--ghost">
                                <i class="fas fa-eye"></i>
                                {% trans "View" %}
                            </a>
                            {% endif %}
                            {% if model.add_url %}
                            <a href="{{ model.add_url }}" class="obc-app-card__action">
                                <i class="fas fa-plus"></i>
                                {% trans "Add" %}
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <p class="obc-app-card__empty">{% trans "No models exposed in admin for this app." %}</p>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% else %}
    <section class="obc-dashboard-section">
        <div class="obc-system-card obc-system-card--empty">
            <span class="obc-system-card__icon"><i class="fas fa-inbox"></i></span>
            <h3 class="obc-system-card__title">{% trans "No applications available" %}</h3>
            <p class="obc-system-card__meta">{% trans "You do not yet have permission to view or edit any modules." %}</p>
        </div>
    </section>
    {% endif %}

    <section class="obc-dashboard-section">
        <div class="obc-system-card">
            <header class="obc-system-card__header">
                <h2 class="obc-system-card__title">
                    <i class="fas fa-info-circle"></i>
                    {% trans "System information" %}
                </h2>
            </header>
            <div class="obc-system-card__body">
                <dl class="obc-system-card__list">
                    <div>
                        <dt>{% trans "Current user" %}</dt>
                        <dd>{{ user.get_username }}</dd>
                    </div>
                    <div>
                        <dt>{% trans "Email" %}</dt>
                        <dd>{{ user.email|default:_('Not provided') }}</dd>
                    </div>
                    <div>
                        <dt>{% trans "Active language" %}</dt>
                        <dd>{{ LANGUAGE_CODE|upper }}</dd>
                    </div>
                    <div>
                        <dt>{% trans "Server time" %}</dt>
                        <dd>{% now "l, M d Y H:i" %}</dd>
                    </div>
                </dl>
            </div>
        </div>
    </section>
</div>
{% endwith %}
{% endblock %}
