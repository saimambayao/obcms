{% extends "admin/base.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% block content_title %}{% endblock %}
{% block content_subtitle %}{% endblock %}
{% block object-tools %}{% endblock %}

{% if not is_popup %}
{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {% if add %}{% blocktrans with name=opts.verbose_name %}Add {{ name }}{% endblocktrans %}{% else %}{{ original|truncatewords:"18" }}{% endif %}
</div>
{% endblock %}
{% endif %}

{% block content %}
<div class="change-form-wrapper">
    <!-- Header Section -->
    <div class="obc-admin-card">
        <div class="obc-admin-card__header">
            <div class="obc-space-between w-full">
                <div>
                    <div class="obc-admin-card__title">
                        <span class="obc-admin-card__icon">
                            {% if opts.app_label == 'common' %}
                                <i class="fas fa-cog"></i>
                            {% elif opts.app_label == 'communities' %}
                                <i class="fas fa-users"></i>
                            {% elif opts.app_label == 'mana' %}
                                <i class="fas fa-map"></i>
                            {% elif opts.app_label == 'coordination' %}
                                <i class="fas fa-handshake"></i>
                            {% elif opts.app_label == 'policy_tracking' %}
                                <i class="fas fa-lightbulb"></i>
                            {% elif opts.app_label == 'documents' %}
                                <i class="fas fa-file-alt"></i>
                            {% else %}
                                <i class="fas fa-edit"></i>
                            {% endif %}
                        </span>
                        <span>
                            {% if add %}
                                {% blocktrans with name=opts.verbose_name %}Add {{ name }}{% endblocktrans %}
                            {% else %}
                                {% trans "Change" %} {{ opts.verbose_name }}
                            {% endif %}
                        </span>
                    </div>
                    {% if not add and original %}
                        <p class="mt-2 text-sm text-slate-500">{{ original }}</p>
                    {% endif %}
                </div>

                <div class="flex flex-wrap items-center gap-3">
                    {% if not add and has_view_permission %}
                        <a href="{% url opts|admin_urlname:'changelist' %}" class="obc-admin-button obc-admin-button--secondary text-sm">
                            <i class="fas fa-list"></i>
                            {% trans "View List" %}
                        </a>
                    {% endif %}

                    {% if not add and has_add_permission %}
                        <a href="{% url opts|admin_urlname:'add' %}" class="obc-admin-button obc-admin-button--primary text-sm">
                            <i class="fas fa-plus"></i>
                            {% blocktrans with name=opts.verbose_name %}Add another {{ name }}{% endblocktrans %}
                        </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Form Section -->
    <form method="post" id="{{ opts.model_name }}_form" class="space-y-6" {% if has_file_field %}enctype="multipart/form-data"{% endif %}>
        {% csrf_token %}
        
        <!-- Form Errors -->
        {% if errors %}
        <div class="form-errors bg-red-50 border-l-4 border-red-400 p-4 rounded-r-md">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-red-400 text-lg"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">{% trans "Please correct the errors below." %}</h3>
                    <div class="mt-2 text-sm text-red-700">
                        {% for field, error_list in errors.items %}
                            {% for error in error_list %}
                                <p>{{ field|capfirst }}: {{ error }}</p>
                            {% endfor %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Non-field errors -->
        {% if adminform.form.non_field_errors %}
        <div class="non-field-errors bg-red-50 border-l-4 border-red-400 p-4 rounded-r-md">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-red-400 text-lg"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">{% trans "Form Errors" %}</h3>
                    <div class="mt-2 text-sm text-red-700">
                        {{ adminform.form.non_field_errors }}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Main Form Fields -->
        <div class="obc-admin-card">
            <div class="obc-admin-card__header">
                <div class="obc-admin-card__title text-lg">
                    <span class="obc-admin-card__icon text-base">
                        <i class="fas fa-pen"></i>
                    </span>
                    <span class="text-base font-semibold text-slate-700">{% trans "Form Details" %}</span>
                </div>
                {% if adminform.form.non_field_errors %}
                    <span class="obc-admin-card__title-badge text-xs">
                        <i class="fas fa-circle-exclamation"></i>
                        {% trans "Check errors" %}
                    </span>
                {% endif %}
            </div>

            <div class="obc-admin-card__body">
                {% if adminform %}
                    <fieldset class="module aligned">
                        {% for fieldset in adminform %}
                            {% include "admin/includes/fieldset.html" %}
                        {% endfor %}
                    </fieldset>
                {% endif %}
            </div>
        </div>

        <!-- Inline Related Objects -->
        {% if inline_admin_formsets %}
        <div class="inline-formsets space-y-6">
            {% for inline_admin_formset in inline_admin_formsets %}
                {% include inline_admin_formset.opts.template %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- Submit Section -->
        <div class="obc-admin-card">
            <div class="obc-admin-card__body obc-admin-actions w-full justify-between">
                <div class="flex flex-wrap gap-3">
                    {% if show_save %}
                        <button type="submit" name="_save" value="1" class="obc-admin-button obc-admin-button--primary">
                            <i class="fas fa-save"></i>
                            {% trans 'Save' %}
                        </button>
                    {% endif %}

                    {% if show_save_and_add_another %}
                        <button type="submit" name="_addanother" value="1" class="obc-admin-button obc-admin-button--secondary">
                            <i class="fas fa-plus"></i>
                            {% trans 'Save and add another' %}
                        </button>
                    {% endif %}

                    {% if show_save_and_continue %}
                        <button type="submit" name="_continue" value="1" class="obc-admin-button obc-admin-button--secondary">
                            <i class="fas fa-edit"></i>
                            {% trans 'Save and continue editing' %}
                        </button>
                    {% endif %}
                </div>

                <div class="flex flex-wrap gap-3">
                    {% if show_delete_link %}
                        <a href="{% url opts|admin_urlname:'delete' original.pk|admin_urlquote %}" class="obc-admin-button obc-admin-button--danger">
                            <i class="fas fa-trash"></i>
                            {% trans "Delete" %}
                        </a>
                    {% endif %}

                    <a href="{% url opts|admin_urlname:'changelist' %}" class="obc-admin-button obc-admin-button--secondary">
                        <i class="fas fa-times"></i>
                        {% trans "Cancel" %}
                    </a>
                </div>
            </div>
        </div>
    </form>

    <!-- Object History (if not adding) -->
    {% if not add and has_change_permission %}
        <div class="obc-admin-card mt-6">
            <div class="obc-admin-card__header">
                <div class="obc-admin-card__title text-lg">
                    <span class="obc-admin-card__icon text-base">
                        <i class="fas fa-history"></i>
                    </span>
                    <span class="text-base font-semibold text-slate-700">{% trans "History" %}</span>
                </div>
            </div>
            <div class="obc-admin-card__body">
                {% if history %}
                    <ul class="space-y-3">
                        {% for action in history %}
                            <li class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg">
                                <span class="w-2 h-2 rounded-full bg-emerald-500 mt-2"></span>
                                <div class="flex-1">
                                    <p class="text-sm font-medium text-slate-700">{{ action.action_text }}</p>
                                    <p class="text-xs text-slate-500">
                                        {{ action.action_time|date:"M d, Y H:i" }} · {{ action.user.get_full_name|default:action.user.username }}
                                    </p>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-sm text-slate-500">{% trans "No history available for this object." %}</p>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>




{% endblock %}
