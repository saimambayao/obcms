{% load static %}

<div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-800 to-emerald-600 px-6 py-4">
        <h3 class="text-lg font-semibold text-white flex items-center">
            <i class="fas fa-key mr-3"></i>
            Permission Details: {{ role.name }}
        </h3>
    </div>

    <!-- Permission Groups (Accordion) -->
    <div class="divide-y divide-gray-200">
        {% for group in permission_groups %}
        <div class="permission-accordion">
            <!-- Accordion Header -->
            <button type="button"
                    onclick="toggleAccordion(this)"
                    class="w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors duration-200"
                    aria-expanded="false">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center">
                        <i class="fas fa-{{ group.icon }} text-white"></i>
                    </div>
                    <div class="text-left">
                        <h4 class="text-sm font-semibold text-gray-900">{{ group.name }}</h4>
                        <p class="text-xs text-gray-500">{{ group.permissions.count }} permissions</p>
                    </div>
                </div>
                <i class="fas fa-chevron-down text-gray-400 transition-transform duration-200"></i>
            </button>

            <!-- Accordion Content -->
            <div class="accordion-content hidden px-6 pb-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 pt-3">
                    {% for permission in group.permissions %}
                    <div class="bg-gray-50 rounded-lg p-3 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <!-- Permission Type Badge -->
                            <span class="inline-flex items-center px-2 py-1 rounded-md text-xs font-medium
                                         {% if permission.type == 'view' %}bg-blue-100 text-blue-800
                                         {% elif permission.type == 'create' %}bg-emerald-100 text-emerald-800
                                         {% elif permission.type == 'edit' %}bg-amber-100 text-amber-800
                                         {% elif permission.type == 'delete' %}bg-red-100 text-red-800
                                         {% else %}bg-purple-100 text-purple-800{% endif %}">
                                {% if permission.type == 'view' %}<i class="fas fa-eye mr-1"></i>
                                {% elif permission.type == 'create' %}<i class="fas fa-plus mr-1"></i>
                                {% elif permission.type == 'edit' %}<i class="fas fa-edit mr-1"></i>
                                {% elif permission.type == 'delete' %}<i class="fas fa-trash mr-1"></i>
                                {% else %}<i class="fas fa-cog mr-1"></i>{% endif %}
                                {{ permission.get_type_display }}
                            </span>
                            <p class="text-xs text-gray-700">{{ permission.name }}</p>
                        </div>
                        {% if permission.is_critical %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"
                              title="Critical permission - use caution">
                            <i class="fas fa-exclamation-triangle"></i>
                        </span>
                        {% endif %}
                    </div>
                    {% empty %}
                    <p class="text-sm text-gray-500 col-span-2">No permissions in this group.</p>
                    {% endfor %}
                </div>

                <!-- Group Description -->
                {% if group.description %}
                <div class="mt-3 pt-3 border-t border-gray-200">
                    <p class="text-xs text-gray-600">
                        <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                        {{ group.description }}
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div class="px-6 py-12 text-center">
            <i class="fas fa-key text-5xl text-gray-300 mb-3"></i>
            <p class="text-gray-500">No permissions assigned to this role.</p>
        </div>
        {% endfor %}
    </div>

    <!-- Summary Footer -->
    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
            <div>
                <p class="text-2xl font-bold text-gray-900">{{ total_permissions }}</p>
                <p class="text-xs text-gray-500 uppercase tracking-wide">Total</p>
            </div>
            <div>
                <p class="text-2xl font-bold text-blue-600">{{ view_permissions }}</p>
                <p class="text-xs text-gray-500 uppercase tracking-wide">View</p>
            </div>
            <div>
                <p class="text-2xl font-bold text-emerald-600">{{ create_permissions }}</p>
                <p class="text-xs text-gray-500 uppercase tracking-wide">Create</p>
            </div>
            <div>
                <p class="text-2xl font-bold text-amber-600">{{ edit_permissions }}</p>
                <p class="text-xs text-gray-500 uppercase tracking-wide">Edit</p>
            </div>
        </div>
    </div>
</div>

<script>
function toggleAccordion(button) {
    const content = button.nextElementSibling;
    const icon = button.querySelector('.fa-chevron-down');
    const isExpanded = button.getAttribute('aria-expanded') === 'true';

    // Toggle content visibility
    if (isExpanded) {
        content.classList.add('hidden');
        icon.style.transform = 'rotate(0deg)';
        button.setAttribute('aria-expanded', 'false');
    } else {
        content.classList.remove('hidden');
        icon.style.transform = 'rotate(180deg)';
        button.setAttribute('aria-expanded', 'true');
    }
}

// Expand first accordion by default
document.addEventListener('DOMContentLoaded', function() {
    const firstAccordion = document.querySelector('.permission-accordion button');
    if (firstAccordion) {
        toggleAccordion(firstAccordion);
    }
});
</script>
