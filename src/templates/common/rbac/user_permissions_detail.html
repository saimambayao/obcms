<!-- User Permissions Detail Modal Content -->
<div class="p-6">
    <!-- User Header -->
    <div class="mb-6 pb-4 border-b border-gray-200">
        <div class="flex items-start justify-between">
            <div>
                <h2 class="text-2xl font-bold text-gray-900">
                    {{ target_user.get_full_name }}
                </h2>
                <p class="mt-1 text-sm text-gray-600">
                    {{ target_user.email }}
                    {% if target_user.position %}
                    <span class="ml-2 text-gray-400">â€¢</span>
                    <span class="ml-2">{{ target_user.position }}</span>
                    {% endif %}
                </p>
            </div>
            <button type="button"
                    onclick="closeRbacModal()"
                    class="text-gray-400 hover:text-gray-600 transition-colors duration-200"
                    aria-label="Close">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button type="button"
                    onclick="switchPermissionTab('roles')"
                    class="permission-tab active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                    data-tab="roles">
                <i class="fas fa-user-tag mr-2"></i>
                Assigned Roles
                <span class="ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {{ user_roles.count }}
                </span>
            </button>
            <button type="button"
                    onclick="switchPermissionTab('permissions')"
                    class="permission-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                    data-tab="permissions">
                <i class="fas fa-key mr-2"></i>
                Direct Permissions
                <span class="ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    {{ direct_permissions.count }}
                </span>
            </button>
            <button type="button"
                    onclick="switchPermissionTab('features')"
                    class="permission-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                    data-tab="features">
                <i class="fas fa-puzzle-piece mr-2"></i>
                Accessible Features
                <span class="ml-2 py-0.5 px-2.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    {{ accessible_features|length }}
                </span>
            </button>
        </nav>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Roles Tab -->
        <div id="roles-tab-content" class="tab-pane active">
            {% if user_roles %}
                <div class="space-y-3">
                    {% for user_role in user_roles %}
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="text-sm font-semibold text-gray-900">
                                    {{ user_role.role.name }}
                                </h3>
                                <p class="mt-1 text-xs text-gray-600">
                                    {{ user_role.role.description }}
                                </p>
                                <div class="mt-2 flex items-center space-x-4 text-xs text-gray-500">
                                    <span>
                                        <i class="fas fa-calendar mr-1"></i>
                                        Assigned {{ user_role.assigned_at|date:"M d, Y" }}
                                    </span>
                                    {% if user_role.assigned_by %}
                                    <span>
                                        <i class="fas fa-user mr-1"></i>
                                        by {{ user_role.assigned_by.get_full_name }}
                                    </span>
                                    {% endif %}
                                    {% if user_role.expires_at %}
                                    <span class="text-amber-600">
                                        <i class="fas fa-clock mr-1"></i>
                                        Expires {{ user_role.expires_at|date:"M d, Y" }}
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                Level {{ user_role.role.level }}
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-user-tag text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-500">No roles assigned</p>
                </div>
            {% endif %}
        </div>

        <!-- Direct Permissions Tab -->
        <div id="permissions-tab-content" class="tab-pane hidden">
            {% if direct_permissions %}
                <div class="space-y-3">
                    {% for user_perm in direct_permissions %}
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <h3 class="text-sm font-semibold text-gray-900">
                                    {{ user_perm.permission.name }}
                                </h3>
                                <p class="mt-1 text-xs text-gray-600">
                                    {{ user_perm.permission.description }}
                                </p>
                                {% if user_perm.reason %}
                                <p class="mt-2 text-xs text-gray-500 italic">
                                    <i class="fas fa-comment mr-1"></i>
                                    {{ user_perm.reason }}
                                </p>
                                {% endif %}
                                <div class="mt-2 flex items-center space-x-4 text-xs text-gray-500">
                                    <span>
                                        <i class="fas fa-calendar mr-1"></i>
                                        Granted {{ user_perm.assigned_at|date:"M d, Y" }}
                                    </span>
                                    {% if user_perm.granted_by %}
                                    <span>
                                        <i class="fas fa-user mr-1"></i>
                                        by {{ user_perm.granted_by.get_full_name }}
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            {% if user_perm.is_granted %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">
                                <i class="fas fa-check mr-1"></i>
                                Granted
                            </span>
                            {% else %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                <i class="fas fa-times mr-1"></i>
                                Denied
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-key text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-500">No direct permissions</p>
                </div>
            {% endif %}
        </div>

        <!-- Features Tab -->
        <div id="features-tab-content" class="tab-pane hidden">
            {% if accessible_features %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {% for feature_key in accessible_features %}
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg p-4 border border-blue-200">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-check-circle text-2xl text-emerald-500"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-semibold text-gray-900">
                                    {{ feature_key|title }}
                                </h3>
                                <p class="text-xs text-gray-600">
                                    Access granted
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-puzzle-piece text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-500">No feature access granted</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Actions Footer -->
    <div class="mt-6 pt-4 border-t border-gray-200 flex justify-end space-x-3">
        <button type="button"
                onclick="closeRbacModal()"
                class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors duration-200">
            Close
        </button>
    </div>
</div>

<script>
function switchPermissionTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.permission-tab').forEach(tab => {
        if (tab.dataset.tab === tabName) {
            tab.classList.add('active', 'border-blue-500', 'text-blue-600');
            tab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        } else {
            tab.classList.remove('active', 'border-blue-500', 'text-blue-600');
            tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
        }
    });

    // Update tab content
    document.querySelectorAll('.tab-pane').forEach(pane => {
        if (pane.id === `${tabName}-tab-content`) {
            pane.classList.remove('hidden');
            pane.classList.add('active');
        } else {
            pane.classList.add('hidden');
            pane.classList.remove('active');
        }
    });
}

// Initialize tabs
document.addEventListener('DOMContentLoaded', function() {
    // Set default active state for tabs
    const firstTab = document.querySelector('.permission-tab.active');
    if (firstTab) {
        firstTab.classList.add('border-blue-500', 'text-blue-600');
    }

    // Set default state for non-active tabs
    document.querySelectorAll('.permission-tab:not(.active)').forEach(tab => {
        tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
    });
});
</script>
