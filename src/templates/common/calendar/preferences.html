{% extends "base.html" %}

{% block title %}{{ page_title|default:"Calendar Preferences" }}{% endblock %}

{% block breadcrumb %}
<li>
    <a href="{% url 'common:dashboard' %}" class="text-neutral-500 hover:text-neutral-700">Dashboard</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li>
    <a href="{% url 'common:oobc_calendar' %}" class="text-neutral-500 hover:text-neutral-700">Calendar</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li class="text-neutral-800 font-semibold">Preferences</li>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                <i class="fas fa-cog text-emerald-600 mr-4"></i>
                {{ page_heading|default:"Calendar Preferences" }}
            </h1>
            <p class="mt-2 text-gray-600">
                Configure how you receive calendar notifications and reminders
            </p>
        </div>
        <a href="{{ return_url }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Calendar
        </a>
    </div>

    <form method="post" class="space-y-6" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
            {{ form.non_field_errors|join:' ' }}
        </div>
        {% endif %}

        <!-- Notification Channels -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
            <header class="bg-gradient-to-r from-emerald-500 to-teal-600 px-6 py-4 rounded-t-2xl text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-bell mr-3"></i>
                    Notification Channels
                </h2>
            </header>
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            {{ form.email_enabled }}
                        </div>
                        <div class="ml-3">
                            <label for="{{ form.email_enabled.id_for_label }}" class="font-medium text-gray-700">
                                {{ form.email_enabled.label }}
                            </label>
                            <p class="text-sm text-gray-500">{{ form.email_enabled.help_text }}</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            {{ form.sms_enabled }}
                        </div>
                        <div class="ml-3">
                            <label for="{{ form.sms_enabled.id_for_label }}" class="font-medium text-gray-700">
                                {{ form.sms_enabled.label }}
                            </label>
                            <p class="text-sm text-gray-500">{{ form.sms_enabled.help_text }}</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            {{ form.push_enabled }}
                        </div>
                        <div class="ml-3">
                            <label for="{{ form.push_enabled.id_for_label }}" class="font-medium text-gray-700">
                                {{ form.push_enabled.label }}
                            </label>
                            <p class="text-sm text-gray-500">{{ form.push_enabled.help_text }}</p>
                        </div>
                    </div>
                </div>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                    <div class="flex">
                        <i class="fas fa-info-circle text-blue-600 mt-0.5 mr-3"></i>
                        <div class="text-sm text-blue-800">
                            <p class="font-semibold mb-1">About Notification Channels</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Email:</strong> Instant notifications and daily/weekly digests</li>
                                <li><strong>SMS:</strong> Critical reminders only (feature coming soon)</li>
                                <li><strong>Push:</strong> Browser notifications when you're online</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Digest Emails -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
            <header class="bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4 rounded-t-2xl text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-envelope mr-3"></i>
                    Digest Emails
                </h2>
            </header>
            <div class="p-6 space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            {{ form.daily_digest }}
                        </div>
                        <div class="ml-3">
                            <label for="{{ form.daily_digest.id_for_label }}" class="font-medium text-gray-700">
                                {{ form.daily_digest.label }}
                            </label>
                            <p class="text-sm text-gray-500">{{ form.daily_digest.help_text }}</p>
                            <p class="text-xs text-gray-400 mt-1">Sent at 7:00 AM daily</p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="flex items-center h-5">
                            {{ form.weekly_digest }}
                        </div>
                        <div class="ml-3">
                            <label for="{{ form.weekly_digest.id_for_label }}" class="font-medium text-gray-700">
                                {{ form.weekly_digest.label }}
                            </label>
                            <p class="text-sm text-gray-500">{{ form.weekly_digest.help_text }}</p>
                            <p class="text-xs text-gray-400 mt-1">Sent every Monday at 7:00 AM</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Reminder Settings -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
            <header class="bg-gradient-to-r from-purple-500 to-indigo-600 px-6 py-4 rounded-t-2xl text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-clock mr-3"></i>
                    Reminder Settings
                </h2>
            </header>
            <div class="p-6 space-y-6">
                <div class="grid grid-cols-1 gap-6">
                    {% include "components/form_field.html" with field=form.default_reminder_times %}

                    {% if reminder_display %}
                    <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-4">
                        <p class="text-sm font-semibold text-emerald-800 mb-2">Current Reminders:</p>
                        <div class="flex flex-wrap gap-2">
                            {% for reminder in reminder_display %}
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">
                                <i class="fas fa-bell mr-1"></i>
                                {{ reminder }} before
                            </span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
                    <div class="flex">
                        <i class="fas fa-lightbulb text-amber-600 mt-0.5 mr-3"></i>
                        <div class="text-sm text-amber-800">
                            <p class="font-semibold mb-1">Common Reminder Patterns</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li><code>[15, 60]</code> - 15 minutes and 1 hour before</li>
                                <li><code>[1440]</code> - 1 day (24 hours) before</li>
                                <li><code>[15, 60, 1440]</code> - 15 min, 1 hour, and 1 day before</li>
                                <li><code>[30, 120, 2880]</code> - 30 min, 2 hours, and 2 days before</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiet Hours -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
            <header class="bg-gradient-to-r from-indigo-500 to-purple-600 px-6 py-4 rounded-t-2xl text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-moon mr-3"></i>
                    Quiet Hours
                </h2>
            </header>
            <div class="p-6 space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% include "components/form_field.html" with field=form.quiet_hours_start %}
                    {% include "components/form_field.html" with field=form.quiet_hours_end %}
                </div>

                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                    <div class="flex">
                        <i class="fas fa-info-circle text-indigo-600 mt-0.5 mr-3"></i>
                        <div class="text-sm text-indigo-800">
                            <p class="font-semibold mb-1">About Quiet Hours</p>
                            <p>
                                During quiet hours, you won't receive push or SMS notifications.
                                Email notifications will still be sent but marked as low priority.
                                Leave both fields empty to receive notifications at any time.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Timezone -->
        <section class="bg-white border border-gray-200 rounded-2xl shadow-sm">
            <header class="bg-gradient-to-r from-teal-500 to-emerald-600 px-6 py-4 rounded-t-2xl text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-globe mr-3"></i>
                    Time Zone Settings
                </h2>
            </header>
            <div class="p-6 space-y-6">
                {% include "components/form_field.html" with field=form.timezone %}

                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <div class="flex">
                        <i class="fas fa-info-circle text-gray-600 mt-0.5 mr-3"></i>
                        <div class="text-sm text-gray-700">
                            <p class="font-semibold mb-1">Current Setting</p>
                            <p>
                                Timezone: <strong>{{ preferences.timezone }}</strong><br>
                                All event times will be displayed in this timezone.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Action Buttons -->
        <div class="flex items-center justify-end space-x-3">
            <a href="{{ return_url }}" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                Cancel
            </a>
            <button type="submit" class="px-4 py-2 text-sm font-semibold text-white rounded-lg shadow bg-emerald-600 hover:bg-emerald-700">
                <i class="fas fa-save mr-2"></i>
                {{ submit_label|default:"Save Preferences" }}
            </button>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Format checkbox inputs
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        checkbox.classList.add('rounded', 'border-gray-300', 'text-emerald-600', 'focus:ring-emerald-500', 'h-4', 'w-4');
    });
});
</script>
{% endblock %}
