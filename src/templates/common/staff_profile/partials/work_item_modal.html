<!-- Work Item Creation Modal for Staff Profile Page -->
<div id="work-item-modal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-black/50 transition-opacity" onclick="closeWorkItemModal()"></div>

    <!-- Modal Container -->
    <div class="fixed inset-0 overflow-y-auto">
        <div class="flex min-h-full items-center justify-center p-4">
            <!-- Modal Panel -->
            <div class="relative w-full max-w-4xl transform rounded-2xl bg-white shadow-2xl transition-all">
                <!-- Modal Content (HTMX Target) -->
                <div id="work-item-modal-content" class="p-6">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-tasks text-4xl mb-3"></i>
                        <p>Click "Create work item" to open form</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Modal functions
window.openWorkItemModal = function() {
    const modal = document.getElementById('work-item-modal');
    if (modal) {
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
        console.log('[Modal] Opened');
    }
};

window.closeWorkItemModal = function() {
    const modal = document.getElementById('work-item-modal');
    if (modal) {
        modal.classList.add('hidden');
        document.body.style.overflow = ''; // Restore scrolling
        console.log('[Modal] Closed');
    }
};

window.openModalAndLoad = function(button) {
    openWorkItemModal();

    const url = button.getAttribute('data-hx-get');
    const target = '#work-item-modal-content';

    if (!url) {
        console.error('[Modal] Missing data-hx-get attribute');
        return;
    }

    setTimeout(() => {
        htmx.ajax('GET', url, {
            target: target,
            swap: 'innerHTML'
        });
    }, 50);
};

// Handle successful form submission
document.body.addEventListener('htmx:beforeSwap', function(event) {
    const target = event.detail.target;
    if (!target || target.id !== 'work-item-modal-content') {
        return;
    }

    const status = event.detail.xhr.status;
    if (status === 204) {
        closeWorkItemModal();
        window.location.reload(); // Refresh to show new work item
        event.detail.shouldSwap = false;
    }
});

console.log('âœ… Work item modal initialized');
</script>
