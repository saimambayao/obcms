{% extends 'base.html' %}

{% block title %}Planning & Budgeting - OBC Management System{% endblock %}

{% block breadcrumb %}
<li>
    <a href="{% url 'common:dashboard' %}" class="text-neutral-500 hover:text-neutral-700">Dashboard</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li>
    <a href="{% url 'common:oobc_management_home' %}" class="text-neutral-500 hover:text-neutral-700">OOBC Management</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li class="text-neutral-800 font-semibold">Planning &amp; Budgeting</li>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-8">
    <!-- Header -->
    <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
        <div class="space-y-3">
            <h1 class="text-3xl font-bold text-gray-900">Planning &amp; Budgeting</h1>
            <p class="text-lg text-gray-600 max-w-4xl">
                Review PPA pipelines, funding allocations, and milestone schedules across OOBC-led and MOA-supported initiatives
                to keep investments aligned with community priorities.
            </p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3">
            <div class="relative inline-block text-left">
                <button type="button" id="exportDropdownButton" class="inline-flex items-center justify-center gap-2 rounded-xl border border-emerald-600 bg-emerald-600 px-5 py-3 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2">
                    <i class="fas fa-download"></i>
                    Export Reports
                    <i class="fas fa-chevron-down text-xs"></i>
                </button>
                <div id="exportDropdownMenu" class="hidden absolute right-0 z-10 mt-2 w-64 origin-top-right rounded-xl bg-white shadow-2xl ring-1 ring-black ring-opacity-5 focus:outline-none">
                    <div class="py-2">
                        <a href="{% url 'monitoring:export_aip_summary' %}" class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-emerald-50 transition">
                            <i class="fas fa-file-excel text-green-600 w-5"></i>
                            <div>
                                <div class="font-semibold">AIP Summary (Excel)</div>
                                <div class="text-xs text-gray-500">Complete investment plan</div>
                            </div>
                        </a>
                        <a href="{% url 'monitoring:export_compliance' %}" class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-emerald-50 transition">
                            <i class="fas fa-file-excel text-green-600 w-5"></i>
                            <div>
                                <div class="font-semibold">Compliance Report (Excel)</div>
                                <div class="text-xs text-gray-500">GAD, CCET, IP, Peace, SDG</div>
                            </div>
                        </a>
                        <a href="{% url 'monitoring:export_funding_timeline' %}" class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-emerald-50 transition">
                            <i class="fas fa-file-excel text-green-600 w-5"></i>
                            <div>
                                <div class="font-semibold">Funding Timeline (Excel)</div>
                                <div class="text-xs text-gray-500">Allocations, obligations, disbursements</div>
                            </div>
                        </a>
                        <a href="{% url 'monitoring:export_budget_csv' %}" class="flex items-center gap-3 px-4 py-3 text-sm text-gray-700 hover:bg-emerald-50 transition">
                            <i class="fas fa-file-csv text-blue-600 w-5"></i>
                            <div>
                                <div class="font-semibold">Budget Summary (CSV)</div>
                                <div class="text-xs text-gray-500">All PPAs in CSV format</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Export dropdown toggle
        document.getElementById('exportDropdownButton').addEventListener('click', function(e) {
            e.stopPropagation();
            const menu = document.getElementById('exportDropdownMenu');
            menu.classList.toggle('hidden');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            const button = document.getElementById('exportDropdownButton');
            const menu = document.getElementById('exportDropdownMenu');
            if (!button.contains(e.target) && !menu.contains(e.target)) {
                menu.classList.add('hidden');
            }
        });
    </script>

    <!-- ========================================================================= -->
    <!-- PLANNING & BUDGETING FEATURES NAVIGATION (Phases 1-8) -->
    <!-- ========================================================================= -->

    <!-- Frequently Used Features -->
    <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl shadow-lg border-2 border-gray-300 overflow-hidden">
        <div class="bg-gradient-to-r from-gray-800 to-gray-900 px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h2 class="text-xl font-semibold text-white flex items-center">
                        <i class="fas fa-star mr-3 text-amber-400"></i>
                        Frequently Used
                    </h2>
                    <p class="text-sm text-gray-300 mt-1">Quick access to your most-used planning & budgeting features</p>
                </div>
                <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium bg-amber-400 text-gray-900">
                    <i class="fas fa-bolt mr-1.5"></i> Quick Access
                </span>
            </div>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Gap Analysis -->
                <a href="{% url 'common:gap_analysis_dashboard' %}" class="group block bg-white p-5 border-2 border-teal-200 rounded-xl hover:border-teal-500 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-3">
                        <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-teal-500 to-emerald-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-chart-pie text-white text-lg"></i>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-teal-50 text-teal-700 border border-teal-200">
                            Analysis
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-900 group-hover:text-teal-600 mb-1">Gap Analysis</h3>
                    <p class="text-xs text-gray-600 mb-3">Funding gaps & unmet needs</p>
                    <div class="flex items-center gap-2 text-xs text-emerald-600">
                        <i class="fas fa-arrow-right"></i>
                        <span class="font-medium">Analyze</span>
                    </div>
                </a>

                <!-- Analytics Dashboard -->
                <a href="{% url 'common:analytics_dashboard' %}" class="group block bg-white p-5 border-2 border-cyan-200 rounded-xl hover:border-cyan-500 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-3">
                        <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-chart-bar text-white text-lg"></i>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-cyan-50 text-cyan-700 border border-cyan-200">
                            Analytics
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-900 group-hover:text-cyan-600 mb-1">Analytics Dashboard</h3>
                    <p class="text-xs text-gray-600 mb-3">Comprehensive insights & trends</p>
                    <div class="flex items-center gap-2 text-xs text-emerald-600">
                        <i class="fas fa-arrow-right"></i>
                        <span class="font-medium">Explore</span>
                    </div>
                </a>

                <!-- Community Voting Results -->
                <a href="{% url 'common:community_voting_results' %}" class="group block bg-white p-5 border-2 border-emerald-200 rounded-xl hover:border-emerald-500 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-3">
                        <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-chart-bar text-white text-lg"></i>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200">
                            Public
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-900 group-hover:text-emerald-600 mb-1">Voting Results</h3>
                    <p class="text-xs text-gray-600 mb-3">Community priority rankings</p>
                    <div class="flex items-center gap-2 text-xs text-emerald-600">
                        <i class="fas fa-arrow-right"></i>
                        <span class="font-medium">View Results</span>
                    </div>
                </a>

                <!-- Budget Scenarios -->
                <a href="{% url 'common:scenario_list' %}" class="group block bg-white p-5 border-2 border-orange-200 rounded-xl hover:border-orange-500 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-3">
                        <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-project-diagram text-white text-lg"></i>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200">
                            Planning
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-900 group-hover:text-orange-600 mb-1">Budget Scenarios</h3>
                    <p class="text-xs text-gray-600 mb-3">What-if budget analysis</p>
                    <div class="flex items-center gap-2 text-xs text-emerald-600">
                        <i class="fas fa-arrow-right"></i>
                        <span class="font-medium">Manage</span>
                    </div>
                </a>

                <!-- Strategic Goals -->
                <a href="{% url 'common:strategic_goals_dashboard' %}" class="group block bg-white p-5 border-2 border-purple-200 rounded-xl hover:border-purple-500 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-3">
                        <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-bullseye text-white text-lg"></i>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-purple-50 text-purple-700 border border-purple-200">
                            Strategic
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-900 group-hover:text-purple-600 mb-1">Strategic Goals</h3>
                    <p class="text-xs text-gray-600 mb-3">3-5 year goals tracking</p>
                    <div class="flex items-center gap-2 text-xs text-emerald-600">
                        <i class="fas fa-arrow-right"></i>
                        <span class="font-medium">Track</span>
                    </div>
                </a>

                <!-- Policy-Budget Matrix -->
                <a href="{% url 'common:policy_budget_matrix' %}" class="group block bg-white p-5 border-2 border-indigo-200 rounded-xl hover:border-indigo-500 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
                    <div class="flex items-start justify-between mb-3">
                        <div class="h-12 w-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <i class="fas fa-th text-white text-lg"></i>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-lg text-xs font-medium bg-indigo-50 text-indigo-700 border border-indigo-200">
                            Policy
                        </span>
                    </div>
                    <h3 class="font-bold text-gray-900 group-hover:text-indigo-600 mb-1">Policy-Budget Matrix</h3>
                    <p class="text-xs text-gray-600 mb-3">Link policies to allocations</p>
                    <div class="flex items-center gap-2 text-xs text-emerald-600">
                        <i class="fas fa-arrow-right"></i>
                        <span class="font-medium">View Matrix</span>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Phase 4: Participatory Budgeting -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-emerald-600 to-green-600 px-6 py-4">
            <h2 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-vote-yea mr-3"></i>
                Participatory Budgeting
            </h2>
            <p class="text-sm text-emerald-100 mt-1">Community engagement in budget prioritization and feedback</p>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <a href="{% url 'common:community_voting_browse' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-500 transition">
                            <i class="fas fa-poll text-emerald-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-emerald-600">Community Voting</h3>
                            <p class="text-xs text-gray-600 mt-1">Vote on community priority needs</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:community_voting_results' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center group-hover:bg-blue-500 transition">
                            <i class="fas fa-chart-bar text-blue-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-blue-600">Voting Results</h3>
                            <p class="text-xs text-gray-600 mt-1">View community voting analytics</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:budget_feedback_dashboard' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center group-hover:bg-purple-500 transition">
                            <i class="fas fa-comments text-purple-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-purple-600">Budget Feedback</h3>
                            <p class="text-xs text-gray-600 mt-1">Service satisfaction and feedback</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:transparency_dashboard' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-cyan-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-cyan-100 flex items-center justify-center group-hover:bg-cyan-500 transition">
                            <i class="fas fa-eye text-cyan-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-cyan-600">Transparency</h3>
                            <p class="text-xs text-gray-600 mt-1">Public budget accountability</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Phase 5: Strategic Planning -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 px-6 py-4">
            <h2 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-bullseye mr-3"></i>
                Strategic Planning
            </h2>
            <p class="text-sm text-purple-100 mt-1">Multi-year strategic goals and Regional Development Plan alignment</p>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <a href="{% url 'common:strategic_goals_dashboard' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center group-hover:bg-purple-500 transition">
                            <i class="fas fa-bullseye text-purple-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-purple-600">Strategic Goals</h3>
                            <p class="text-xs text-gray-600 mt-1">3-5 year goals and progress tracking</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:annual_planning_dashboard' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center group-hover:bg-blue-500 transition">
                            <i class="fas fa-calendar-alt text-blue-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-blue-600">Annual Planning</h3>
                            <p class="text-xs text-gray-600 mt-1">Fiscal year planning cycles</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:regional_development_alignment' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-500 transition">
                            <i class="fas fa-map-marked-alt text-emerald-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-emerald-600">RDP Alignment</h3>
                            <p class="text-xs text-gray-600 mt-1">Regional Development Plan alignment</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Phase 6: Scenario Planning & Optimization -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-orange-600 to-red-600 px-6 py-4">
            <h2 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-project-diagram mr-3"></i>
                Scenario Planning & Optimization
            </h2>
            <p class="text-sm text-orange-100 mt-1">What-if analysis and budget optimization algorithms</p>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <a href="{% url 'common:scenario_list' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-orange-100 flex items-center justify-center group-hover:bg-orange-500 transition">
                            <i class="fas fa-list text-orange-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-orange-600">Budget Scenarios</h3>
                            <p class="text-xs text-gray-600 mt-1">Manage what-if budget scenarios</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:scenario_create' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-500 transition">
                            <i class="fas fa-plus-circle text-emerald-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-emerald-600">Create Scenario</h3>
                            <p class="text-xs text-gray-600 mt-1">Build new budget scenario</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:scenario_compare' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center group-hover:bg-blue-500 transition">
                            <i class="fas fa-balance-scale text-blue-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-blue-600">Compare Scenarios</h3>
                            <p class="text-xs text-gray-600 mt-1">Side-by-side scenario comparison</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Phase 7: Analytics & Forecasting -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-cyan-600 to-blue-600 px-6 py-4">
            <h2 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-chart-area mr-3"></i>
                Analytics & Forecasting
            </h2>
            <p class="text-sm text-cyan-100 mt-1">Advanced analytics, trends, forecasts, and impact assessment</p>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <a href="{% url 'common:analytics_dashboard' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-cyan-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-cyan-100 flex items-center justify-center group-hover:bg-cyan-500 transition">
                            <i class="fas fa-chart-bar text-cyan-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-cyan-600">Analytics Dashboard</h3>
                            <p class="text-xs text-gray-600 mt-1">Comprehensive insights</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:budget_forecasting' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center group-hover:bg-purple-500 transition">
                            <i class="fas fa-chart-line text-purple-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-purple-600">Budget Forecasting</h3>
                            <p class="text-xs text-gray-600 mt-1">3-year projections</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:trend_analysis' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center group-hover:bg-blue-500 transition">
                            <i class="fas fa-chart-area text-blue-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-blue-600">Trend Analysis</h3>
                            <p class="text-xs text-gray-600 mt-1">Multi-year trends</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:impact_assessment' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-500 transition">
                            <i class="fas fa-bullseye text-emerald-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-emerald-600">Impact Assessment</h3>
                            <p class="text-xs text-gray-600 mt-1">Outcomes & effectiveness</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Phase 1-3: Supporting Tools -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4">
            <h2 class="text-xl font-semibold text-white flex items-center">
                <i class="fas fa-calculator mr-3"></i>
                Supporting Planning Tools
            </h2>
            <p class="text-sm text-blue-100 mt-1">Additional resources for comprehensive budget planning</p>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <a href="{% url 'common:gap_analysis_dashboard' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-emerald-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-emerald-100 flex items-center justify-center group-hover:bg-emerald-500 transition">
                            <i class="fas fa-chart-pie text-emerald-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-emerald-600">Gap Analysis</h3>
                            <p class="text-xs text-gray-600 mt-1">Identify funding gaps and unmet needs</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:policy_budget_matrix' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-purple-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center group-hover:bg-purple-500 transition">
                            <i class="fas fa-th text-purple-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-purple-600">Policy-Budget Matrix</h3>
                            <p class="text-xs text-gray-600 mt-1">Link policies to budget allocations</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:mao_focal_persons_registry' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-orange-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-orange-100 flex items-center justify-center group-hover:bg-orange-500 transition">
                            <i class="fas fa-address-book text-orange-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-orange-600">MAO Registry</h3>
                            <p class="text-xs text-gray-600 mt-1">Focal persons and contact information</p>
                        </div>
                    </div>
                </a>

                <a href="{% url 'common:community_needs_summary' %}" class="block p-4 border-2 border-gray-200 rounded-lg hover:border-teal-500 hover:shadow-md transition group">
                    <div class="flex items-start gap-3">
                        <div class="h-10 w-10 rounded-lg bg-teal-100 flex items-center justify-center group-hover:bg-teal-500 transition">
                            <i class="fas fa-users text-teal-600 group-hover:text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-900 group-hover:text-teal-600">Community Needs</h3>
                            <p class="text-xs text-gray-600 mt-1">Aggregated community needs summary</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- ========================================================================= -->
    <!-- END PLANNING & BUDGETING FEATURES NAVIGATION -->
    <!-- ========================================================================= -->

    {% if is_empty_state and empty_state_links %}
    <div class="rounded-2xl border border-dashed border-emerald-200 bg-emerald-50 px-6 py-6 shadow-inner">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
            <div class="flex items-start gap-4">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl bg-emerald-500 text-white shadow-lg">
                    <i class="fas fa-chart-line text-xl"></i>
                </div>
                <div class="space-y-1">
                    <h2 class="text-xl font-semibold text-emerald-900">No planning entries recorded yet</h2>
                    <p class="text-sm text-emerald-800 max-w-2xl">
                        Capture at least one MOA project, OOBC initiative, or community request to unlock the full planning and budget analytics.
                        Use the quick actions below to get started or import data from recent reports.
                    </p>
                </div>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 w-full lg:w-auto">
                {% for link in empty_state_links %}
                <a href="{{ link.url }}" class="group flex flex-col rounded-xl border border-emerald-100 bg-white px-4 py-3 shadow-sm transition hover:border-emerald-300 hover:shadow-md">
                    <div class="flex items-center gap-2 text-emerald-600">
                        <i class="fas {{ link.icon }} text-sm"></i>
                        <span class="text-sm font-semibold">{{ link.label }}</span>
                    </div>
                    <p class="mt-2 text-xs text-emerald-700 leading-snug">{{ link.description }}</p>
                </a>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Totals Row 1 -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-emerald-500 to-green-500 text-white">
                <p class="text-sm uppercase tracking-wide text-emerald-100">Total Budget</p>
                <p class="mt-2 text-3xl font-semibold">₱{{ totals.budget_total|floatformat:2 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Aggregate allocation recorded across all monitoring entries.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-blue-500 to-sky-500 text-white">
                <p class="text-sm uppercase tracking-wide text-blue-100">OBC Allocation</p>
                <p class="mt-2 text-3xl font-semibold">₱{{ totals.budget_obc_total|floatformat:2 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Funding earmarked specifically for Other Bangsamoro Communities.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-purple-500 to-indigo-500 text-white">
                <p class="text-sm uppercase tracking-wide text-purple-100">Projects</p>
                <p class="mt-2 text-3xl font-semibold">{{ totals.projects|default:0 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Active entries across OOBC PPAs, MOA PPAs, and OBC requests.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-teal-500 to-cyan-500 text-white">
                <p class="text-sm uppercase tracking-wide text-cyan-100">Average Progress</p>
                <p class="mt-2 text-3xl font-semibold">{{ totals.avg_progress|floatformat:0 }}%</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Overall completion across all monitored initiatives.</p>
        </div>
    </div>

    <!-- Totals Row 2 -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6">
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-amber-500 to-yellow-500 text-white">
                <p class="text-sm uppercase tracking-wide text-amber-100">Budget Ceiling</p>
                <p class="mt-2 text-3xl font-semibold">₱{{ totals.budget_ceiling_total|floatformat:2 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Aggregate ceilings assigned per funding source for scenario planning.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-emerald-500 to-lime-500 text-white">
                <p class="text-sm uppercase tracking-wide text-emerald-100">Recorded Allocations</p>
                <p class="mt-2 text-3xl font-semibold">₱{{ totals.allocation_total|floatformat:2 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Tranches tagged as allocations across funding flows.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-indigo-500 to-blue-600 text-white">
                <p class="text-sm uppercase tracking-wide text-indigo-100">Recorded Obligations</p>
                <p class="mt-2 text-3xl font-semibold">₱{{ totals.obligation_total|floatformat:2 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Obligations booked against programmed PPAs.</p>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-4 py-5 bg-gradient-to-r from-sky-500 to-cyan-500 text-white">
                <p class="text-sm uppercase tracking-wide text-sky-100">Recorded Disbursements</p>
                <p class="mt-2 text-3xl font-semibold">₱{{ totals.disbursement_total|floatformat:2 }}</p>
            </div>
            <p class="px-4 py-3 text-sm text-gray-600">Disbursements reported through funding flow entries.</p>
        </div>
    </div>

    <!-- Variance Tracking -->
    <div class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-orange-500 to-red-500 text-white flex items-center justify-between">
            <h2 class="text-xl font-semibold flex items-center">
                <i class="fas fa-chart-line mr-3"></i>
                Variance Analysis
            </h2>
            <span class="text-sm text-orange-100">Budget vs Actual Performance</span>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Variance Rate Card -->
                <div class="bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-200 rounded-lg px-5 py-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs uppercase tracking-wide text-orange-700 font-semibold">Overall Variance</div>
                        <i class="fas fa-balance-scale text-orange-400"></i>
                    </div>
                    <div class="text-2xl font-bold text-orange-900">
                        {% if totals.budget_total > 0 %}
                            {% widthratio totals.allocation_total totals.budget_total 100 as variance_pct %}
                            {{ variance_pct|floatformat:1 }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                    <p class="text-xs text-orange-600 mt-2">Allocations vs Budget</p>
                </div>

                <!-- Obligation Rate -->
                <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-lg px-5 py-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs uppercase tracking-wide text-blue-700 font-semibold">Obligation Rate</div>
                        <i class="fas fa-hand-holding-usd text-blue-400"></i>
                    </div>
                    <div class="text-2xl font-bold text-blue-900">
                        {% if totals.allocation_total > 0 %}
                            {% widthratio totals.obligation_total totals.allocation_total 100 as oblig_rate %}
                            {{ oblig_rate|floatformat:1 }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                    <p class="text-xs text-blue-600 mt-2">Obligations / Allocations</p>
                </div>

                <!-- Disbursement Rate -->
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-lg px-5 py-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="text-xs uppercase tracking-wide text-green-700 font-semibold">Disbursement Rate</div>
                        <i class="fas fa-money-check-alt text-green-400"></i>
                    </div>
                    <div class="text-2xl font-bold text-green-900">
                        {% if totals.obligation_total > 0 %}
                            {% widthratio totals.disbursement_total totals.obligation_total 100 as disb_rate %}
                            {{ disb_rate|floatformat:1 }}%
                        {% else %}
                            0%
                        {% endif %}
                    </div>
                    <p class="text-xs text-green-600 mt-2">Disbursements / Obligations</p>
                </div>
            </div>

            <!-- Performance Indicators -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-sm font-semibold text-gray-700 mb-4">Performance Indicators</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div class="flex-shrink-0 w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-check text-green-600"></i>
                        </div>
                        <div>
                            <div class="text-sm font-semibold text-gray-900">Budget Utilization</div>
                            <div class="text-xs text-gray-600">
                                {% if totals.budget_total > 0 %}
                                    {% widthratio totals.disbursement_total totals.budget_total 100 as util_rate %}
                                    {{ util_rate|floatformat:1 }}% of budget disbursed
                                {% else %}
                                    No budget recorded
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <div class="flex-shrink-0 w-10 h-10 bg-amber-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-amber-600"></i>
                        </div>
                        <div>
                            <div class="text-sm font-semibold text-gray-900">Variance Alert</div>
                            <div class="text-xs text-gray-600">
                                {% if totals.allocation_total > totals.budget_total %}
                                    ₱{{ totals.allocation_total|floatformat:2 }} over budget
                                {% else %}
                                    Within budget limits
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category & Status -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-emerald-500 to-green-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-project-diagram mr-3"></i>
                    Category Breakdown
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if category_breakdown %}
                    {% for category in category_breakdown %}
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ category.label }}</p>
                                <p class="text-sm text-gray-500">{{ category.projects }} project{{ category.projects|pluralize }} • Avg progress {{ category.avg_progress|floatformat:0 }}%</p>
                            </div>
                            <span class="text-sm font-medium text-emerald-600">₱{{ category.total_budget|floatformat:2 }}</span>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-emerald-700">
                        <i class="fas fa-folder-open text-2xl"></i>
                        <p class="text-base font-semibold">No PPAs captured yet</p>
                        <p class="text-sm text-emerald-600 max-w-xs">Start logging PPAs so you can compare MOA, OOBC, and community-driven initiatives side by side.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">No monitoring entries are available yet.</p>
                {% endif %}
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-stream mr-3"></i>
                    Implementation Status
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if status_breakdown %}
                    {% for status in status_breakdown %}
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ status.label }}</p>
                                <p class="text-sm text-gray-500">{{ status.projects }} project{{ status.projects|pluralize }}</p>
                            </div>
                            <span class="text-sm font-medium text-indigo-600">₱{{ status.budget|floatformat:2 }}</span>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-indigo-600">
                        <i class="fas fa-clipboard-list text-2xl"></i>
                        <p class="text-base font-semibold">Statuses will appear here</p>
                        <p class="text-sm text-indigo-500 max-w-xs">Track whether PPAs are under planning, ongoing, or completed once entries are encoded.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">No implementation status data captured yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sector, Appropriation, Funding -->
    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-teal-500 to-emerald-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-layer-group mr-3"></i>
                    Sector Mix
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if sector_breakdown %}
                    {% for sector in sector_breakdown %}
                        <div class="flex items-start justify-between">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ sector.label }}</p>
                                <p class="text-sm text-gray-500">{{ sector.projects }} project{{ sector.projects|pluralize }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-medium text-teal-600">₱{{ sector.budget|floatformat:2 }}</p>
                                <p class="text-xs text-gray-400">Ceiling ₱{{ sector.ceiling|floatformat:2 }}</p>
                            </div>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-emerald-700">
                        <i class="fas fa-seedling text-2xl"></i>
                        <p class="text-base font-semibold">No PPAs tagged to sectors yet</p>
                        <p class="text-sm text-emerald-600 max-w-xs">Once you encode PPAs, classify them by sector to analyse where resources are flowing.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">Sector tags will appear once PPAs are classified.</p>
                {% endif %}
            </div>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-rose-500 to-pink-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-file-invoice mr-3"></i>
                    Appropriation Class
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if appropriation_breakdown %}
                    {% for app in appropriation_breakdown %}
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ app.label }}</p>
                                <p class="text-sm text-gray-500">{{ app.projects }} project{{ app.projects|pluralize }}</p>
                            </div>
                            <span class="text-sm font-medium text-rose-600">₱{{ app.budget|floatformat:2 }}</span>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-rose-600">
                        <i class="fas fa-coins text-2xl"></i>
                        <p class="text-base font-semibold">Budget classes pending</p>
                        <p class="text-sm text-rose-500 max-w-xs">Categorise spending into PS, MOOE, or CO once allocations are recorded so the mix graph lights up.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">Classifications into PS, MOOE, or CO will surface here.</p>
                {% endif %}
            </div>
        </div>
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-sky-500 to-blue-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-funnel-dollar mr-3"></i>
                    Funding Sources
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if funding_breakdown %}
                    {% for funding in funding_breakdown %}
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-base font-semibold text-gray-900">{{ funding.label }}</p>
                                <p class="text-sm text-gray-500">{{ funding.projects }} project{{ funding.projects|pluralize }}</p>
                            </div>
                            <span class="text-sm font-medium text-blue-600">₱{{ funding.budget|floatformat:2 }}</span>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-blue-600">
                        <i class="fas fa-wallet text-2xl"></i>
                        <p class="text-base font-semibold">No funding tagged yet</p>
                        <p class="text-sm text-blue-500 max-w-xs">Record whether PPAs draw from GAA, the BARMM block grant, LGU counterparts, or partners to compare sources.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">Record funding sources to surface analytics here.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Compliance & Workflow -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-check-circle mr-3"></i>
                    Compliance Snapshot
                </h2>
            </div>
            <div class="p-6">
                {% with total=compliance_summary.total|default:0 %}
                <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="bg-indigo-50 border border-indigo-100 rounded-lg px-4 py-3">
                        <dt class="text-xs uppercase tracking-wide text-indigo-700">GAD Tagged</dt>
                        <dd class="mt-1 text-lg font-semibold text-indigo-900">{{ compliance_summary.gad|default:0 }}</dd>
                        <p class="text-xs text-indigo-600">{{ compliance_summary.gad_pct|floatformat:1 }}% of portfolio</p>
                    </div>
                    <div class="bg-sky-50 border border-sky-100 rounded-lg px-4 py-3">
                        <dt class="text-xs uppercase tracking-wide text-sky-700">Climate (CCET)</dt>
                        <dd class="mt-1 text-lg font-semibold text-sky-900">{{ compliance_summary.ccet|default:0 }}</dd>
                        <p class="text-xs text-sky-600">{{ compliance_summary.ccet_pct|floatformat:1 }}% of portfolio</p>
                    </div>
                    <div class="bg-emerald-50 border border-emerald-100 rounded-lg px-4 py-3">
                        <dt class="text-xs uppercase tracking-wide text-emerald-700">Indigenous Peoples</dt>
                        <dd class="mt-1 text-lg font-semibold text-emerald-900">{{ compliance_summary.ip|default:0 }}</dd>
                        <p class="text-xs text-emerald-600">{{ compliance_summary.ip_pct|floatformat:1 }}% of portfolio</p>
                    </div>
                    <div class="bg-rose-50 border border-rose-100 rounded-lg px-4 py-3">
                        <dt class="text-xs uppercase tracking-wide text-rose-700">Peace Agenda</dt>
                        <dd class="mt-1 text-lg font-semibold text-rose-900">{{ compliance_summary.peace|default:0 }}</dd>
                        <p class="text-xs text-rose-600">{{ compliance_summary.peace_pct|floatformat:1 }}% of portfolio</p>
                    </div>
                    <div class="bg-amber-50 border border-amber-100 rounded-lg px-4 py-3 sm:col-span-2">
                        <dt class="text-xs uppercase tracking-wide text-amber-700">SDG Aligned</dt>
                        <dd class="mt-1 text-lg font-semibold text-amber-900">{{ compliance_summary.sdg|default:0 }}</dd>
                        <p class="text-xs text-amber-600">{{ compliance_summary.sdg_pct|floatformat:1 }}% of portfolio</p>
                    </div>
                </dl>
                {% if not total %}
                    <p class="text-sm text-gray-600 mt-4">Tag PPAs for required national mandates to populate this dashboard.</p>
                {% endif %}
                {% endwith %}
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-cyan-500 to-blue-600 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-route mr-3"></i>
                    Workflow Snapshot
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if workflow_summary %}
                    {% for stage in workflow_summary %}
                        <div class="border border-blue-100 rounded-lg p-4 bg-blue-50">
                            <div class="flex items-center justify-between">
                                <p class="text-base font-semibold text-blue-900">{{ stage.label }}</p>
                                <span class="text-xs font-medium text-blue-600 uppercase">{{ stage.total }} stage update{{ stage.total|pluralize }}</span>
                            </div>
                            <div class="mt-3 grid grid-cols-2 gap-2">
                                {% for status in stage.statuses %}
                                    <div class="bg-white rounded-md border border-blue-100 px-3 py-2 text-xs text-blue-700 flex items-center justify-between">
                                        <span>{{ status.label }}</span>
                                        <span class="font-semibold text-blue-900">{{ status.count }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-blue-600">
                        <i class="fas fa-sitemap text-2xl"></i>
                        <p class="text-base font-semibold">Budget workflow not started</p>
                        <p class="text-sm text-blue-500 max-w-xs">Each PPA will show its stage once you begin encoding Budget Call, Formulation, and Execution updates.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">Encode workflow stages to monitor budget cycle compliance.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Funding Timeline & Needs Coverage -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-emerald-500 to-lime-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-timeline mr-3"></i>
                    Funding Timeline
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if funding_timeline %}
                    {% for tranche in funding_timeline %}
                        <div class="border border-emerald-100 rounded-lg p-4 bg-emerald-50">
                            <p class="text-xs uppercase tracking-wide text-emerald-600">{% if tranche.scheduled_date %}{{ tranche.scheduled_date|date:"M d, Y" }}{% else %}TBD{% endif %}</p>
                            <p class="text-base font-semibold text-emerald-900">{{ tranche.entry.title }}</p>
                            <p class="text-sm text-emerald-700">{{ tranche.get_tranche_type_display }} • ₱{{ tranche.amount|floatformat:2 }}</p>
                            {% if tranche.remarks %}
                                <p class="text-xs text-emerald-600 mt-2">{{ tranche.remarks }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-emerald-700">
                        <i class="fas fa-calendar-plus text-2xl"></i>
                        <p class="text-base font-semibold">No tranches scheduled yet</p>
                        <p class="text-sm text-emerald-600 max-w-xs">Add allocation, obligation, or disbursement records to see upcoming cash flow milestones.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">Record upcoming allocation, obligation, and disbursement tranches to populate the timeline.</p>
                {% endif %}
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white">
                <h2 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-exclamation-triangle mr-3"></i>
                    Needs Coverage Gaps
                </h2>
            </div>
            <div class="p-6 space-y-4">
                {% if needs_gap_entries %}
                    {% for item in needs_gap_entries %}
                        <div class="border border-amber-100 rounded-lg p-4 bg-amber-50 space-y-2">
                            <div class="flex items-center justify-between">
                                <p class="text-base font-semibold text-amber-900">{{ item.title }}</p>
                                <span class="text-xs uppercase text-amber-600 font-semibold">{{ item.get_priority_display }}</span>
                            </div>
                            <p class="text-sm text-amber-700">{{ item.summary|default:"No summary provided." }}</p>
                            <p class="text-xs text-amber-600">Assessment linked: {% if item.related_assessment %}Yes{% else %}Pending{% endif %} • Strategic tags: {% if item.goal_alignment %}{{ item.goal_alignment|join:", " }}{% else %}Not tagged{% endif %}</p>
                        </div>
                    {% endfor %}
                {% elif is_empty_state %}
                    <div class="flex flex-col items-center justify-center text-center space-y-2 py-8 text-amber-600">
                        <i class="fas fa-lightbulb text-2xl"></i>
                        <p class="text-base font-semibold">Priorities will surface here</p>
                        <p class="text-sm text-amber-500 max-w-xs">Link assessments and tag strategic goals so the system can spotlight unmet needs.</p>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-600">Link PPAs to assessments and strategic tags to monitor priority coverage.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Top allocations -->
    <div class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-amber-500 to-orange-500 text-white flex items-center justify-between">
            <h2 class="text-xl font-semibold flex items-center">
                <i class="fas fa-coins mr-3"></i>
                Highest Allocations
            </h2>
            <span class="text-sm text-amber-100">Top 10 budgeted initiatives</span>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Title</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Category</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Lead</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Budget</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Progress</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for entry in top_allocations %}
                    <tr class="hover:bg-amber-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ entry.title }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ entry.get_category_display }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {% if entry.lead_organization %}
                                {{ entry.lead_organization.name }}
                            {% elif entry.submitted_by_community %}
                                {{ entry.submitted_by_community.name }}
                            {% else %}
                                —
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">₱{{ entry.budget_allocation|floatformat:2 }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ entry.progress }}%</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="px-6 py-6 text-center text-sm text-gray-500">No budget information recorded.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Upcoming milestones -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="px-6 py-4 bg-gradient-to-r from-teal-500 to-cyan-500 text-white flex items-center justify-between">
            <h2 class="text-xl font-semibold flex items-center">
                <i class="fas fa-calendar-check mr-3"></i>
                Upcoming Milestones
            </h2>
            <span class="text-sm text-cyan-100">As of {{ today|date:"M d, Y" }}</span>
        </div>
        <div class="p-6">
            {% if upcoming_milestones %}
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                {% for entry in upcoming_milestones %}
                <div class="border border-cyan-100 rounded-lg p-4 bg-cyan-50">
                    <p class="text-sm text-cyan-600 font-semibold uppercase">{{ entry.next_milestone_date|date:"M d, Y" }}</p>
                    <h3 class="mt-1 text-lg font-semibold text-gray-900">{{ entry.title }}</h3>
                    <p class="text-sm text-gray-600">{{ entry.get_category_display }} • Progress {{ entry.progress }}%</p>
                    {% if entry.oobc_unit %}
                        <p class="text-xs text-gray-500 mt-2">OOBC Unit: {{ entry.oobc_unit }}</p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-10">
                <i class="fas fa-calendar-times text-3xl text-cyan-400"></i>
                <p class="mt-3 text-sm text-gray-600">No upcoming milestones scheduled.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
