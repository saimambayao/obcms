{% with script_id="question-config-"|add:question.id %}
    {{ question|json_script:script_id }}
{% endwith %}

{% if question.type == 'structured' %}
<div class="bg-neutral-50 border border-gray-100 rounded-2xl p-6 space-y-4" data-structured-field data-question-id="{{ question.id }}">
    <div class="space-y-1">
        <h3 class="text-lg font-semibold text-gray-900">{{ field.label }}</h3>
        <p class="text-sm text-gray-500">{{ field.help_text }}</p>
    </div>
    {{ field }}
    <div class="grid gap-4 md:grid-cols-2" data-structured-items>
        {% for subfield in question.fields %}
        <div class="flex flex-col gap-2">
            <label class="text-xs uppercase tracking-wide text-gray-500">{{ subfield.label|default:subfield.name }}</label>
            {% if subfield.type == 'select' %}
                <select data-structured-input="{{ subfield.name }}"
                        class="px-4 py-2 rounded-lg border border-gray-200 focus:ring-emerald-500 focus:border-emerald-500 text-sm bg-white">
                    <option value="">Select option</option>
                    {% for option in subfield.options %}
                        {% if option.value %}
                            <option value="{{ option.value }}">{{ option.label|default:option.value }}</option>
                        {% else %}
                            <option value="{{ option }}">{{ option }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            {% else %}
                <input type="{{ subfield.type|default:'text' }}"
                       data-structured-input="{{ subfield.name }}"
                       {% if subfield.min is not None %}min="{{ subfield.min }}"{% endif %}
                       {% if subfield.max is not None %}max="{{ subfield.max }}"{% endif %}
                       class="px-4 py-2 rounded-lg border border-gray-200 focus:ring-emerald-500 focus:border-emerald-500 text-sm"
                       placeholder="{{ subfield.placeholder|default:'' }}">
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="bg-neutral-50 border border-gray-100 rounded-2xl p-6 space-y-4" data-repeater-field data-question-id="{{ question.id }}">
    <div class="flex items-start justify-between gap-4">
        <div>
            <h3 class="text-lg font-semibold text-gray-900">{{ field.label }}</h3>
            <p class="text-sm text-gray-500">{{ field.help_text }}</p>
        </div>
        <button type="button"
                data-repeater-add
                class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-emerald-200 text-sm font-medium text-emerald-600 hover:bg-emerald-50 transition">
            <i class="fas fa-plus"></i>
            Add Item
        </button>
    </div>
    {{ field }}
    <div class="space-y-4" data-repeater-items></div>
</div>
{% endif %}
