{% extends 'base.html' %}

{% block title %}New Assessment - MANA System{% endblock %}

{% block breadcrumb %}
<li>
    <a href="{% url 'common:dashboard' %}" class="text-neutral-500 hover:text-neutral-700">Dashboard</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li>
    <a href="{% url 'mana:mana_home' %}" class="text-neutral-500 hover:text-neutral-700">MANA</a>
</li>
<li><span class="text-neutral-400 mx-1">/</span></li>
<li class="text-neutral-800 font-semibold">New Assessment</li>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 flex items-center">
            <i class="fas fa-plus-circle text-green-600 mr-4"></i>
            New OBC-MANA Assessment
        </h1>
        <p class="mt-2 text-lg text-gray-600">
            Create a comprehensive Other Bangsamoro Communities - Mapping and Needs Assessment
        </p>
        <div class="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-4">
            <p class="text-sm text-blue-800">
                <i class="fas fa-info-circle mr-2"></i>
                Choose from 4 MANA methodologies: Desk Review, Surveys, Key Informant Interviews (KIIs), or FGD/Workshops (5-day structure)
            </p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Form -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
                    <h2 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-clipboard-list mr-3 text-2xl"></i>
                        Assessment Details
                    </h2>
                </div>
                <div class="p-6">
                    <form method="post" class="space-y-6">
                        {% csrf_token %}
                        
                        <!-- Basic Information -->
                        <div class="bg-gradient-to-r from-gray-50 to-green-50 rounded-lg p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-green-500 mr-2"></i>
                                Basic Information
                            </h3>
                            <div class="grid grid-cols-1 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Assessment Title</label>
                                    <input type="text" name="title"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                           placeholder="e.g., OBC-MANA Activity in [Region/Province] - [Year]">
                                </div>
                            </div>
                        </div>

                        <!-- Geographic Coverage -->
                        <div class="bg-white rounded-xl p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-map-marked-alt text-blue-500 mr-2"></i>
                                Geographic Coverage
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-1">
                                    <label for="region-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Region<span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative">
                                        <select id="region-select" name="region" required
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Region</option>
                                            {% for region in regions %}
                                            <option value="{{ region.id }}">{{ region.name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="province-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Province
                                    </label>
                                    <div class="relative">
                                        <select id="province-select" name="province"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Province</option>
                                            {% for province in provinces %}
                                            <option value="{{ province.id }}" data-region="{{ province.region_id }}">{{ province.name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- MANA Methodology -->
                        <div class="bg-white rounded-xl p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-tasks text-blue-500 mr-2"></i>
                                MANA Methodology
                            </h3>
                            {% with methodology=request.GET.primary_methodology|default:'workshop' %}
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-3">
                                        Primary MANA Activity<span class="text-red-500">*</span>
                                    </label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <label class="flex items-start p-4 border-2 border-emerald-500 bg-emerald-50 rounded-xl cursor-pointer transition-all hover:shadow-md">
                                            <input type="radio" name="primary_methodology" value="workshop" class="mt-1 mr-3 text-emerald-600 focus:ring-emerald-500" {% if methodology == 'workshop' %}checked{% endif %} required>
                                            <div>
                                                <div class="font-semibold text-emerald-900">FGD / Workshops</div>
                                                <div class="text-sm text-emerald-700 mt-1">5-day workshop structure</div>
                                            </div>
                                        </label>
                                        <label class="flex items-start p-4 border-2 border-gray-200 bg-white rounded-xl cursor-pointer transition-all hover:border-gray-300 hover:shadow-md">
                                            <input type="radio" name="primary_methodology" value="desk_review" class="mt-1 mr-3 text-emerald-600 focus:ring-emerald-500" {% if methodology == 'desk_review' %}checked{% endif %}>
                                            <div>
                                                <div class="font-semibold text-gray-900">Desk Review / Research</div>
                                                <div class="text-sm text-gray-600 mt-1">Literature review and analysis</div>
                                            </div>
                                        </label>
                                        <label class="flex items-start p-4 border-2 border-gray-200 bg-white rounded-xl cursor-pointer transition-all hover:border-gray-300 hover:shadow-md">
                                            <input type="radio" name="primary_methodology" value="survey" class="mt-1 mr-3 text-emerald-600 focus:ring-emerald-500" {% if methodology == 'survey' %}checked{% endif %}>
                                            <div>
                                                <div class="font-semibold text-gray-900">Surveys</div>
                                                <div class="text-sm text-gray-600 mt-1">Structured questionnaires</div>
                                            </div>
                                        </label>
                                        <label class="flex items-start p-4 border-2 border-gray-200 bg-white rounded-xl cursor-pointer transition-all hover:border-gray-300 hover:shadow-md">
                                            <input type="radio" name="primary_methodology" value="kii" class="mt-1 mr-3 text-emerald-600 focus:ring-emerald-500" {% if methodology == 'kii' %}checked{% endif %}>
                                            <div>
                                                <div class="font-semibold text-gray-900">Key Informant Interviews</div>
                                                <div class="text-sm text-gray-600 mt-1">In-depth stakeholder interviews</div>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="priority-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Priority Level
                                    </label>
                                    <div class="relative">
                                        <select id="priority-select" name="priority"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="critical">Critical Priority</option>
                                            <option value="high">High Priority</option>
                                            <option value="medium" selected>Medium Priority</option>
                                            <option value="low">Low Priority</option>
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endwith %}
                        </div>

                        <!-- Workshop Configuration (shown when workshop methodology is selected) -->
                        <div id="workshop_config" class="bg-gradient-to-r from-gray-50 to-purple-50 rounded-lg p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-users text-purple-500 mr-2"></i>
                                5-Day Workshop Structure
                            </h3>
                            <div class="bg-white rounded-lg p-4 border border-purple-200 mb-4">
                                <h4 class="font-semibold text-purple-800 mb-3">Workshop Schedule Overview</h4>
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-3 text-sm">
                                    <div class="bg-blue-50 p-3 rounded border">
                                        <div class="font-semibold text-blue-800">Day 1</div>
                                        <div class="text-blue-600">Arrival & Registration</div>
                                    </div>
                                    <div class="bg-green-50 p-3 rounded border">
                                        <div class="font-semibold text-green-800">Day 2</div>
                                        <div class="text-green-600">Opening & Community Context</div>
                                    </div>
                                    <div class="bg-yellow-50 p-3 rounded border">
                                        <div class="font-semibold text-yellow-800">Day 3</div>
                                        <div class="text-yellow-600">Aspirations & Collaboration</div>
                                    </div>
                                    <div class="bg-orange-50 p-3 rounded border">
                                        <div class="font-semibold text-orange-800">Day 4</div>
                                        <div class="text-orange-600">Feedback & Ways Forward</div>
                                    </div>
                                    <div class="bg-gray-50 p-3 rounded border">
                                        <div class="font-semibold text-gray-800">Day 5</div>
                                        <div class="text-gray-600">Departure</div>
                                    </div>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Target Participants</label>
                                    <input type="number" name="target_participants" min="15" max="50" value="30"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                           placeholder="Recommended: 25-40 participants">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Venue Location</label>
                                    <input type="text" name="venue_location" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                                           placeholder="Workshop venue details">
                                </div>
                            </div>
                        </div>
                        

                        <!-- Team Composition -->
                        <div class="bg-white rounded-xl p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-users-cog text-orange-500 mr-2"></i>
                                OBC-MANA Team Composition
                                <span class="ml-2 text-xs text-gray-500 font-normal">(OOBC Staff/Executives only)</span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-1">
                                    <label for="team-leader-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Team Leader
                                    </label>
                                    <div class="relative">
                                        <select id="team-leader-select" name="team_leader"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Team Leader</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}{% if staff.staff_profile.position_classification %} - {{ staff.staff_profile.position_classification }}{% endif %}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="deputy-leader-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Deputy Team Leader
                                    </label>
                                    <div class="relative">
                                        <select id="deputy-leader-select" name="deputy_leader"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Deputy Leader</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}{% if staff.staff_profile.position_classification %} - {{ staff.staff_profile.position_classification }}{% endif %}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="workshop-1-facilitator" class="block text-sm font-medium text-gray-700 mb-2">
                                        Workshop 1 Facilitator
                                    </label>
                                    <div class="relative">
                                        <select id="workshop-1-facilitator" name="workshop_1_facilitator"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Facilitator</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="workshop-2-facilitator" class="block text-sm font-medium text-gray-700 mb-2">
                                        Workshop 2 Facilitator
                                    </label>
                                    <div class="relative">
                                        <select id="workshop-2-facilitator" name="workshop_2_facilitator"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Facilitator</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="workshop-3-facilitator" class="block text-sm font-medium text-gray-700 mb-2">
                                        Workshop 3 Facilitator
                                    </label>
                                    <div class="relative">
                                        <select id="workshop-3-facilitator" name="workshop_3_facilitator"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Facilitator</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="workshop-4-facilitator" class="block text-sm font-medium text-gray-700 mb-2">
                                        Workshop 4 Facilitator
                                    </label>
                                    <div class="relative">
                                        <select id="workshop-4-facilitator" name="workshop_4_facilitator"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Facilitator</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="workshop-5-facilitator" class="block text-sm font-medium text-gray-700 mb-2">
                                        Workshop 5 Facilitator
                                    </label>
                                    <div class="relative">
                                        <select id="workshop-5-facilitator" name="workshop_5_facilitator"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Facilitator</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <label for="lead-documenter-select" class="block text-sm font-medium text-gray-700 mb-2">
                                        Lead Documenter
                                    </label>
                                    <div class="relative">
                                        <select id="lead-documenter-select" name="lead_documenter"
                                                class="block w-full py-3 px-4 text-base rounded-xl border border-gray-200 shadow-sm focus:ring-emerald-500 focus:border-emerald-500 min-h-[48px] appearance-none pr-12 bg-white transition-all duration-200">
                                            <option value="">Select Lead Documenter</option>
                                            {% for staff in staff_members %}
                                            <option value="{{ staff.id }}">{{ staff.get_full_name }}</option>
                                            {% endfor %}
                                        </select>
                                        <span class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-4">
                                            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Timeline & Implementation -->
                        <div class="bg-gradient-to-r from-gray-50 to-teal-50 rounded-lg p-6 border border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-calendar-alt text-teal-500 mr-2"></i>
                                Implementation Timeline
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Planned Start Date</label>
                                    <input type="date" name="planned_start_date"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Planned End Date</label>
                                    <input type="date" name="planned_end_date"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Estimated Budget (PHP)</label>
                                    <input type="number" name="estimated_budget" step="0.01" min="0"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
                                           placeholder="0.00">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Funding Source</label>
                                    <input type="text" name="funding_source" 
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
                                           placeholder="OOBC, BARMM, etc.">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Assessment Objectives</label>
                                    <textarea name="objectives" rows="3"
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
                                              placeholder="Describe the key objectives of this OBC-MANA assessment (SMART objectives recommended)"></textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
                                    <textarea name="description" rows="3"
                                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500"
                                              placeholder="Detailed description of the MANA assessment purpose and scope"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                            <a href="{% url 'mana:mana_home' %}" 
                               class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-semibold flex items-center transition-colors duration-200">
                                <i class="fas fa-arrow-left mr-2"></i>
                                Back to MANA
                            </a>
                            <button type="submit" 
                                    class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white py-3 px-8 rounded-lg font-semibold flex items-center transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                                <i class="fas fa-save mr-2"></i>
                                Create Assessment
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
            <!-- Recent Assessments -->
            <div class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
                    <h3 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-clock mr-3 text-2xl"></i>
                        Recent Assessments
                    </h3>
                </div>
                <div class="p-6">
                    {% if recent_assessments %}
                    <div class="space-y-3">
                        {% for assessment in recent_assessments %}
                        <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg p-3 border border-blue-200">
                            <p class="text-sm font-semibold text-gray-900">{{ assessment.title }}</p>
                            <p class="text-xs text-blue-600">{{ assessment.community.name }}</p>
                            <p class="text-xs text-gray-500">{{ assessment.created_at|timesince }} ago</p>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-clipboard-list text-3xl mb-4"></i>
                        <p>No assessments yet</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- MANA Guidelines -->
            <div class="bg-white rounded-xl shadow-xl border border-gray-200 overflow-hidden">
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-4">
                    <h3 class="text-xl font-bold text-white flex items-center">
                        <i class="fas fa-book mr-3 text-2xl"></i>
                        OBC-MANA Guidelines
                    </h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200">
                            <h4 class="font-semibold text-blue-800 mb-2 flex items-center">
                                <i class="fas fa-users mr-2"></i>
                                Workshop Structure
                            </h4>
                            <p class="text-sm text-blue-700 mb-2">5-day comprehensive workshop including:</p>
                            <ul class="text-xs text-blue-600 space-y-1">
                                <li>• Day 1: Arrival & Registration</li>
                                <li>• Day 2-4: 6 Core Workshops</li>
                                <li>• Day 5: Departure</li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-4 border border-green-200">
                            <h4 class="font-semibold text-green-800 mb-2 flex items-center">
                                <i class="fas fa-clipboard-list mr-2"></i>
                                Assessment Domains
                            </h4>
                            <p class="text-sm text-green-700 mb-2">Focus on OBC priority areas:</p>
                            <ul class="text-xs text-green-600 space-y-1">
                                <li>• Social Development</li>
                                <li>• Economic Development</li>
                                <li>• Cultural Development</li>
                                <li>• Protection of Rights</li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-4 border border-purple-200">
                            <h4 class="font-semibold text-purple-800 mb-2 flex items-center">
                                <i class="fas fa-cogs mr-2"></i>
                                Team Composition
                            </h4>
                            <p class="text-sm text-purple-700 mb-2">Required team roles:</p>
                            <ul class="text-xs text-purple-600 space-y-1">
                                <li>• Team Leader</li>
                                <li>• Facilitators & Documenters</li>
                                <li>• Admin & Logistics Support</li>
                            </ul>
                        </div>
                        <div class="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg p-4 border border-orange-200">
                            <h4 class="font-semibold text-orange-800 mb-2 flex items-center">
                                <i class="fas fa-calendar-check mr-2"></i>
                                Implementation Phases
                            </h4>
                            <p class="text-sm text-orange-700 mb-2">Three main phases:</p>
                            <ul class="text-xs text-orange-600 space-y-1">
                                <li>• Pre-MANA: Planning & Preparation</li>
                                <li>• During-MANA: Workshop Execution</li>
                                <li>• Post-MANA: Analysis & Reporting</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Related Actions</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <a href="{% url 'mana:mana_home' %}" class="group bg-white rounded-lg shadow-lg border border-gray-200 hover-lift transition-all duration-200">
                <div class="p-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fas fa-home text-white text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 group-hover:text-green-600 transition-colors">
                        MANA Home
                    </h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Return to MANA overview.
                    </p>
                    <div class="mt-4 flex items-center text-green-600 text-sm font-medium">
                        <span>Go to Home</span>
                        <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                    </div>
                </div>
            </a>

            <a href="{% url 'mana:mana_manage_assessments' %}" class="group bg-white rounded-lg shadow-lg border border-gray-200 hover-lift transition-all duration-200">
                <div class="p-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fas fa-list-alt text-white text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors">
                        Manage Assessments
                    </h3>
                    <p class="mt-2 text-sm text-gray-600">
                        View existing assessments.
                    </p>
                    <div class="mt-4 flex items-center text-blue-600 text-sm font-medium">
                        <span>Manage</span>
                        <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                    </div>
                </div>
            </a>

            <a href="{% url 'mana:mana_geographic_data' %}" class="group bg-white rounded-lg shadow-lg border border-gray-200 hover-lift transition-all duration-200">
                <div class="p-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fas fa-map-marked-alt text-white text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 group-hover:text-purple-600 transition-colors">
                        Geographic Data
                    </h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Mapping and GIS data.
                    </p>
                    <div class="mt-4 flex items-center text-purple-600 text-sm font-medium">
                        <span>View Maps</span>
                        <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
                    </div>
                </div>
            </a>
            
            <div class="group bg-gradient-to-br from-orange-50 to-yellow-50 rounded-lg shadow-lg border border-orange-200">
                <div class="p-6">
                    <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center mb-4">
                        <i class="fas fa-file-alt text-white text-xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900">
                        MANA Report
                    </h3>
                    <p class="mt-2 text-sm text-gray-600">
                        Generate after completion.
                    </p>
                    <div class="mt-4 flex items-center text-orange-600 text-sm font-medium">
                        <span>Post-Assessment</span>
                        <i class="fas fa-clock ml-2"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Show/hide workshop configuration based on methodology selection
document.addEventListener('DOMContentLoaded', function() {
    const methodologyRadios = document.querySelectorAll('input[name="primary_methodology"]');
    const workshopConfig = document.getElementById('workshop_config');

    function toggleWorkshopConfig() {
        const selectedMethodology = document.querySelector('input[name="primary_methodology"]:checked')?.value;
        if (selectedMethodology === 'workshop') {
            workshopConfig.style.display = 'block';
        } else {
            workshopConfig.style.display = 'none';
        }
    }

    // Initial state
    toggleWorkshopConfig();

    // Listen for changes
    methodologyRadios.forEach(radio => {
        radio.addEventListener('change', toggleWorkshopConfig);
    });

    // Set default dates (5 days from start date for workshops)
    const startDateInput = document.querySelector('input[name="planned_start_date"]');
    const endDateInput = document.querySelector('input[name="planned_end_date"]');

    startDateInput?.addEventListener('change', function() {
        const selectedMethodology = document.querySelector('input[name="primary_methodology"]:checked')?.value;
        if (selectedMethodology === 'workshop' && this.value) {
            const startDate = new Date(this.value);
            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 4); // 5 days total
            endDateInput.value = endDate.toISOString().split('T')[0];
        }
    });

    // Region-Province cascading dropdown
    const regionSelect = document.getElementById('region-select');
    const provinceSelect = document.getElementById('province-select');

    if (regionSelect && provinceSelect) {
        const allProvinceOptions = Array.from(provinceSelect.options);

        regionSelect.addEventListener('change', function() {
            const selectedRegionId = this.value;

            // Clear province dropdown
            provinceSelect.innerHTML = '<option value="">Select Province</option>';

            if (selectedRegionId) {
                // Filter and add provinces for selected region
                allProvinceOptions.forEach(option => {
                    if (option.value && option.dataset.region === selectedRegionId) {
                        provinceSelect.appendChild(option.cloneNode(true));
                    }
                });
            } else {
                // If no region selected, show all provinces
                allProvinceOptions.forEach(option => {
                    if (option.value) {
                        provinceSelect.appendChild(option.cloneNode(true));
                    }
                });
            }
        });
    }
});
</script>
{% endblock %}
