SEVALLA DEPLOYMENT TIMEOUT SUPPORT REQUEST
==========================================

Application: OBCMS App (obcms-app-0bu1p)
Issue: Consistent deployment timeout with "context deadline exceeded" error
Severity: Critical - Automatic deployments failing consistently

PROBLEM DESCRIPTION
===================
Our application is experiencing consistent deployment failures on Sevalla. The error is:

Error: release obcms-app-0bu1p-web failed, and has been uninstalled due to atomic being set: context deadline exceeded

This occurs consistently at approximately 17 minutes after deployment starts, regardless of code changes.

KEY FINDINGS FROM INVESTIGATION
===============================

1. APPLICATION HEALTH
   ✅ App starts successfully: "OBCMS server is ready. Listening on 0.0.0.0:8080" (at 10:16:22)
   ✅ All 4 Gunicorn workers initialize correctly
   ✅ Zero errors in application logs
   ✅ Application is fully functional and healthy
   ✅ Readiness probe returns 200 OK immediately

2. DEPLOYMENT TIMEOUT PATTERN
   ❌ Automatic deployment (on-commit): 17m 4s - FAILS
   ❌ Automatic deployment (on-commit): 17m 10s - FAILS
   ❌ Automatic deployment (on-commit): 17m 11s - FAILS
   ✅ Manual deployment (same code): 3m 2s - SUCCESS

3. CRITICAL OBSERVATION
   The EXACT SAME CODE (commit b2a8237) deployed:
   - Manually via Sevalla: Completes in 3 minutes ✅
   - Automatically via GitHub webhook: Fails at 17 minutes ❌

   This proves the issue is NOT in the application code, but in how Sevalla's
   automatic deployment pipeline differs from manual deployments.

4. FAILURE TIMELINE
   Oct 24, 2025:
   - 10:00 AM: Deployment 03b3f1e starts
   - 10:16:22: App ready and listening on port 8080
   - 10:17:38: Deployment fails (~17 minutes after start)
   - Error: Helm atomic rollback due to timeout

TECHNICAL ANALYSIS
==================

The error "context deadline exceeded" with Helm atomic flag indicates:
1. Helm set to automatically rollback on timeout (atomic=true)
2. Deployment orchestration phase extending beyond timeout window
3. Post-deployment validation or hooks not completing in time
4. Issue occurs AFTER app startup (not during readiness probe)

This is a KNOWN HELM ISSUE documented in:
- GitHub Helm #12239 (CronJob suspend timeout)
- GitHub Helm #12796 (Atomic rollback failure)
- GitHub Helm #9094 (Context deadline exceeded)

QUESTIONS FOR SEVALLA SUPPORT
=============================

1. TIMEOUT CONFIGURATION
   - What is the Helm atomic timeout setting for automatic deployments?
   - Is it different from manual deployments?
   - Can it be increased from the default (~15-20 minutes)?

2. POST-DEPLOYMENT HOOKS
   - Are there any post-deployment hooks running after app startup?
   - Could post-deployment validation be timing out?
   - Are there checks validating the Celery worker process?

3. DEPLOYMENT PIPELINE DIFFERENCES
   - What specifically differs between manual and automatic deployment processes?
   - Why does the same code succeed manually (3 min) but fail automatically (17 min)?
   - Is there additional validation only in the automatic pipeline?

4. CONFIGURATION CHANGES
   - Can you disable or increase the Helm atomic timeout?
   - Can we skip post-deployment hooks that might be blocking?
   - Can the automatic deployment use the same configuration as manual?

WHAT WE'VE VERIFIED
===================

✅ Readiness check code: Correct (returns 200 OK immediately)
✅ Application startup: Perfect (no errors)
✅ Worker initialization: All 4 workers ready
✅ Database connectivity: Working
✅ Dependencies: All healthy
✅ Procfile: Correct (no migrations in release phase)
✅ Code quality: No deployment-related issues

REQUESTED ACTIONS
=================

1. Investigate the ~14 minute difference between manual (3 min) and automatic (17 min) deployments
2. Check Helm atomic timeout configuration for automatic deployments
3. Identify any post-deployment hooks or validation steps
4. Increase timeout or disable atomic rollback for automatic deployments
5. Align automatic deployment configuration with manual deployment process

DEPLOYMENT COMMITS TO TEST
==========================

If you want to reproduce the issue:
- Commit b2a8237: Works manually (3m 2s), fails automatically (17m 10s)
- Commit 03b3f1e: Current branch, fails automatically (17m 4s)

Branch: staging
Repository: saimambayao/obcms

We're ready to help troubleshoot further. Please let us know what additional information would be helpful.

Thank you,
OBCMS Development Team
